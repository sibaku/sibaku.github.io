var it=Float32Array,ye=Float64Array,_e=Int8Array,be=Uint8Array,ge=Uint8ClampedArray,me=Int16Array,Ie=Uint16Array,Ue=Int32Array,Ee=Uint32Array,ve=BigInt64Array,ke=BigUint64Array,je=Array,O=it;function ze(n,t){return n!==void 0?n:t}var J=class n{constructor(t,e,r,o=1,s=e){this._data=t,this._rows=e,this._cols=r,this._innerStride=o,this._outerStride=s}static new(t,e,r,o,s){return new n(t,e,r,o,s)}rows(){return this._rows}cols(){return this._cols}index(t,e){return e=e!==void 0?e:0,this._innerStride*(t+e*this._outerStride)}at(t,e){var r=this.index(t,e);if(r>this._data.length)throw new Error("Trying to access data outside of range");return this._data[r]}set(t,e,r){let o=this.index(e,r);if(o>this._data.length)throw new Error("Trying to access data outside of range");return this._data[o]=t,this}type(){return this._data.constructor}},z=class n{constructor(t){this._type=t}static new(t){return new n(t)}static newFromMat(t){return new n(t.type!==void 0&&t.type instanceof Function?t.type():Array)}uninitialized(t,e){let r=t*e,o=new this._type(r);return J.new(o,t,e)}from(t,e,r){let o=e*r,s=new this._type(o);for(let i=0;i<o;i++)s[i]=t[i];return J.new(s,e,r)}fromRows(t){let e=t.length;if(e<1)throw new Error("At least one row needed");let r=t[0].cols(),o=this.uninitialized(e,r);for(let s=0;s<e;s++)R(D(o,s),t[s]);return o}fromCols(t){let e=t.length;if(e<1)throw new Error("At least one column needed");let r=t[0].rows(),o=this.uninitialized(r,e);for(let s=0;s<e;s++)R(x(o,s),t[s]);return o}all(t,e,r){let o=e*r,s=new this._type(o);for(let i=0;i<o;i++)s[i]=t;return J.new(s,e,r)}zeros(t,e){return this.all(0,t,e)}ones(t,e){return this.all(1,t,e)}id(t,e=t){let r=this.zeros(t,e),o=K(r);return gt(o,1),r}copy(t){let e=t.cols(),r=t.rows(),o=e*r,s=new this._type(o),i=0;for(let a=0;a<e;a++)for(let f=0;f<r;f++)s[i]=t.at(f,a),i++;return J.new(s,r,e)}rand(t,e){let r=t,o=e,s=o*r,i=new this._type(s),a=0;for(let f=0;f<o;f++)for(let d=0;d<r;d++)i[a]=Math.random(),a++;return J.new(i,r,o)}},Re=new z(Float32Array),Pe=new z(Float64Array),xt=new z(Array),Se=new z(Int8Array),xe=new z(Uint8Array),Te=new z(Uint8ClampedArray),Ae=new z(Int16Array),De=new z(Uint16Array),Le=new z(Int32Array),qe=new z(Uint32Array),Fe=new z(BigInt64Array),Ne=new z(BigUint64Array),F=class n{constructor(t){this._type=t,this._factory=z.new(t)}static new(t){return new n(t)}static newFromMat(t){return new n(t.type!==void 0&&t.type instanceof Function?t.type():Array)}from(t,e=t.length){return this._factory.from(t,e,1)}uninitialized(t){return this._factory.uninitialized(t,1)}all(t,e){return this._factory.all(t,e,1)}zeros(t){return this.all(0,t)}ones(t){return this.all(1,t)}id(t){return this._factory.id(t)}copy(t){if(!X(t))throw new Error("Vector factory can't copy from non-vector");return this._factory.copy(t)}rand(t){return this._factory.rand(t,1)}},$=new F(Float32Array),Ce=new F(Float64Array),Oe=new F(Array),Be=new F(Int8Array),We=new F(Uint8Array),Ye=new F(Uint8ClampedArray),Ze=new F(Int16Array),Ke=new F(Uint16Array),Xe=new F(Int32Array),Ge=new F(Uint32Array),Je=new F(BigInt64Array),Qe=new F(BigUint64Array),ot=class n{constructor(t,e,r,o){if(this._data=t,this._rows=e!==void 0?e:this._data.length,this._cols=r!==void 0?r:this._rows,this._stride=o!==void 0?o:1,this._data.length<this._stride*Math.min(this._rows,this._cols))throw new Error("Not enough data for diagonal construction")}static new(t,e,r,o){return new n(t,e,r,o)}static fromMat(t,e,r,o){if(!X(t))throw new Error("Diagonal only takes vectors as input");let s=ct(t);return this.new(s,e,r,o)}rows(){return this._rows}cols(){return this._cols}at(t,e){return t!==e?0:this._data[this._stride*t]}set(t,e,r){if(e!==r)throw new Error("Trying to set offdiagonal element of diagonal matrix");return this._data[this._stride*e]=t,this}type(){return this._data.constructor}},L=class n{constructor(t){this._type=t}static new(t){return new n(t)}static newFromMat(t){return new n(t.type!==void 0&&t.type instanceof Function?t.type():Array)}from(t,e,r=e){let o=Math.min(e,r),s=new this._type(o);for(let i=0;i<o;i++)s[i]=t[i];return ot.new(s,e,r)}uninitialized(t,e){e=e!==void 0?e:t;let r=Math.min(t,e),o=new this._type(r);return ot.new(o,t,e)}all(t,e,r=e){let o=Math.min(e,r),s=new this._type(o);for(let i=0;i<o;i++)s[i]=t;return ot.new(s,e,r)}id(t,e){return this.all(1,t,e)}rand(t,e){e=e!==void 0?e:t;let r=Math.min(t,e),o=new this._type(r);for(let s=0;s<o.length;s++)o[s]=Math.random();return ot.new(o,t,e)}},$e=new L(Float32Array),Ve=new L(Float64Array),He=new L(Array),tn=new L(Int8Array),en=new L(Uint8Array),nn=new L(Uint8ClampedArray),rn=new L(Int16Array),sn=new L(Uint16Array),on=new L(Int32Array),an=new L(Uint32Array),cn=new L(BigInt64Array),ln=new L(BigUint64Array),It=class n{constructor(t){this._m=t,this._size=Math.min(this._m.rows(),this._m.cols())}static new(t){return new n(t)}rows(){return this._size}cols(){return 1}at(t){return this._m.at(t,t)}set(t,e){return this._m.set(t,e,e),this}type(){return this._m.type()}},ft=class n{constructor(t,e,r,o,s){this._m=t,this._i=e,this._j=r,this._rows=o,this._cols=s}static new(t,e,r,o,s){return new n(t,e,r,o,s)}rows(){return this._rows}cols(){return this._cols}at(t,e){return e=e!==void 0?e:0,this._m.at(t+this._i,e+this._j)}set(t,e,r){return r=r!==void 0?r:0,this._m.set(t,e+this._i,r+this._j)}type(){return this._m.type()}},Ut=class n extends ft{constructor(t,e){let r=t.rows();super(t,0,e,r,1)}static new(t,e){return new n(t,e)}},Et=class n extends ft{constructor(t,e){let r=t.cols();super(t,e,0,1,r)}static new(t,e){return new n(t,e)}},vt=class n{constructor(t){this._m=t}static new(t){return new n(t)}rows(){return this._m.cols()}cols(){return this._m.rows()}at(t,e){return e=e!==void 0?e:0,this._m.at(e,t)}set(t,e,r){return r=r!==void 0?r:0,this._m.set(t,r,e)}type(){return this._m.type()}},A={UPPER:0,LOWER:1,STRICTLY_UPPER:2,STRICTLY_LOWER:3,UNIT_UPPER:4,UNIT_LOWER:5},pt=class n{constructor(t,e){this._m=t,this._mode=e}static new(t,e){return new n(t,e)}rows(){return this._m.rows()}cols(){return this._m.cols()}checkIndex(t,e){return this._mode===A.UPPER&&t<=e||this._mode===A.LOWER&&t>=e||(this._mode===A.STRICTLY_UPPER||this._mode===A.UNIT_UPPER)&&t<e||(this._mode===A.STRICTLY_LOWER||this._mode===A.UNIT_LOWER)&&t>e}at(t,e){switch(this._mode){case A.UPPER:return t>e?0:this._m.at(t,e);case A.LOWER:return t<e?0:this._m.at(t,e);case A.STRICTLY_UPPER:return t>=e?0:this._m.at(t,e);case A.STRICTLY_LOWER:return t<=e?0:this._m.at(t,e);case A.UNIT_LOWER:return t<e?0:t===e?1:this._m.at(t,e);case A.UNIT_UPPER:return t>=e?0:t===e?1:this._m.at(t,e);default:break}}set(t,e,r){if(!this.checkIndex(e,r))throw new Error("Trying to set value outside triangular part");return this._m.set(t,e,r),this}type(){return this._m.type()}solve(t,e){return this._mode===A.UPPER||this._mode===A.STRICTLY_UPPER||this._mode===A.UNIT_UPPER?Ot(this,t,e):Ct(this,t,e)}},kt=class n{constructor(t,e=t.length,r=e,o=O){this._data=t,this._rows=e,this._cols=r,this._type=o}static new(t,e,r,o){return new n(t,e,r,o)}at(t,e=0){return t=this._data[t],t===e?1:0}set(){throw new Error("Permuation matrix is immutable")}rows(){return this._cols}cols(){return this._cols}type(){return this._type}},Tt=class n{constructor(t,e,r){if(e>=t.rows()||r>=t.cols())throw new Error("Trying to remove row/column outside of source");this._m=t,this._i=e,this._j=r}static new(t,e,r){return new n(t,e,r)}rows(){return this._m.rows()-1}cols(){return this._m.cols()-1}at(t,e){return t>=this._i&&(t+=1),e>=this._j&&(e+=1),this._m.at(t,e)}set(t,e,r){return e>=this._i&&(e+=1),r>=this._j&&(r+=1),this._m.set(t,e,r)}type(){return this._m.type()}},At=class n{constructor(t,e,r,o=0,s=1){if(this._m=t,this._rows=e,this._cols=r,this._rows<t.rows()||this._cols<t.cols())throw new Error("Padded View needs to be at least as big as source");this._offDiagonalValue=o,this._diagonalValue=s}static new(t,e,r,o,s){return new n(t,e,r,o,s)}rows(){return this._rows}cols(){return this._cols}at(t,e){return t<this._m.rows()&&e<this._m.cols()?this._m.at(t,e):t===e?this._diagonalValue:this._offDiagonalValue}set(t,e,r){if(e<this._m.rows()&&r<this._colsm.cols())return this._m.set(t,e,r);throw new Error("Trying to set values in padding")}type(){return this._m.type()}};function v(n,t,e){return t=t!==void 0?t:n.rows(),e=e!==void 0?e:n.cols(),z.new(n.type()).uninitialized(t,e)}function N(n){return z.new(n.type()).copy(n)}function X(n){return n.cols()===1}function Yt(n){return n.rows()===1}function fn(n,t){let e=n.rows(),r=n.cols();for(let o=0;o<r;o++)for(let s=0;s<e;s++)n.set(n.at(s,o)+t,s,o);return n}function jt(n,t,e){if(n.cols()!==t.cols()||n.rows()!==t.rows())throw new Error("Trying to add input of different sizes");let r=n.rows(),o=n.cols();e=e!==void 0?e:v(n);for(let s=0;s<o;s++)for(let i=0;i<r;i++){let a=n.at(i,s)+t.at(i,s);e.set(a,i,s)}return e}function bt(n,t,e){if(n.cols()!==t.cols()||n.rows()!==t.rows())throw new Error("Trying to add input of different sizes");let r=n.rows(),o=n.cols();e=e!==void 0?e:v(n);for(let s=0;s<o;s++)for(let i=0;i<r;i++){let a=n.at(i,s)-t.at(i,s);e.set(a,i,s)}return e}function gt(n,t){let e=n.rows(),r=n.cols();for(let o=0;o<r;o++)for(let s=0;s<e;s++)n.set(t,s,o);return n}function un(n,t,e){return tt(n,(r,o,s)=>r*t.at(o,s),e)}function hn(n,t,e){return tt(n,(r,o,s)=>Math.min(r,t.at(o,s)),e)}function wn(n,t,e){return tt(n,(r,o,s)=>Math.max(r,t.at(o,s)),e)}function dn(n,t,e){return tt(n,(r,o,s)=>r/t.at(o,s),e)}function K(n){return It.new(n)}function C(n,t,e,r=n.rows()-t,o=n.cols()-e){return ft.new(n,t,e,r,o)}function D(n,t){return Et.new(n,t)}function x(n,t){return Ut.new(n,t)}function V(n,t,e){let r=n.rows(),o=n.cols();if(o!==t.rows())throw new Error("Incompatible matrix dimensions");let s=t.cols();if(e=e!==void 0?e:v(n,r,s),e.rows()!==r||e.cols()!==s)throw new Error("Output dimension does not match input");for(let i=0;i<s;i++)for(let a=0;a<r;a++){let f=0;for(let d=0;d<o;d++)f+=n.at(a,d)*t.at(d,i);e.set(f,a,i)}return e}function Zt(n,t){let e=n.rows(),r=n.cols();t=t!==void 0?t:v(n);for(let o=0;o<r;o++)for(let s=0;s<e;s++)t.set(-n.at(s,o),s,o);return t}function Mn(n,t){return tt(n,e=>Math.abs(e),t)}function wt(n){return gt(n,0)}function pn(n){return gt(n,1)}function H(n){let t=n.rows(),e=n.cols();for(let r=0;r<e;r++)for(let o=0;o<t;o++){let s=o===r?1:0;n.set(s,o,r)}return n}function Q(n){return vt.new(n)}function tt(n,t,e){let r=n.rows(),o=n.cols();e=e!==void 0?e:v(n);for(let s=0;s<o;s++)for(let i=0;i<r;i++)e.set(t(n.at(i,s),i,s),i,s);return e}function yn(n,t){let e=z.new(t).uninitialized(n.rows(),n.cols());return tt(n,r=>r,e)}function B(n,t,e){let r=e===void 0,o=n.rows(),s=n.cols();if(r&&o*s===0)throw new Error("Calling reduce on empty input without initial value");let i=r?n.at(0,0):e;for(let a=0;a<s;a++)for(let f=0;f<o;f++){if(r){r=!1;continue}i=t(i,n.at(f,a),f,a,n)}return i}function Kt(n){return B(n,(t,e)=>t+e)}function _n(n){return B(n,(t,e)=>t+Math.abs(e),0)}function bn(n){return B(n,(t,e)=>t+e*e,0)}function gn(n){return Kt(K(n))}function mn(n){let t=ht(n);return Xt(t)}function Xt(n){let t=n.S;for(let e=0;e<t.rows();e++)if(t.at(e)<1e-7)return e;return t.rows()}function In(n){let t=ht(n);return Gt(t)}function Gt(n){let t=n.S,e=t.at(0),r=t.at(t.rows()-1);return e/r}function Un(n){return B(n,(t,e)=>Math.max(t,e))}function En(n){return B(n,(t,e)=>Math.min(t,e))}function vn(n){return B(n,(t,e,r,o)=>(e>t.v&&(t.v=e,t.row=r,t.col=o),t),{v:-1/0,row:-1,col:-1})}function kn(n){return B(n,(t,e,r,o)=>(e<t.v&&(t.v=e,t.row=r,t.col=o),t),{v:1/0,row:-1,col:-1})}function ct(n){let t=n.cols(),e=n.rows(),r=[];for(let o=0;o<t;o++)for(let s=0;s<e;s++)r.push(n.at(s,o));return r}function Jt(n,t,e=O){return L.new(e).id(n,t)}function jn(n,t,e=O){return z.new(e).zeros(n,t)}function zn(n,t,e=O){return z.new(e).rand(n,t)}function Rn(n,t,e=O){return z.new(e).ones(n,t)}function dt(n,t,e=O){return z.new(e).uninitialized(n,t)}function Pn(n,t,e,r=O){return z.new(r).copy(J.new(n,t,e))}function Qt(n,t=O){let e=n.length;return z.new(t).copy(J.new(n,e,1))}function Sn(n,t=O){return z.new(t).uninitialized(n,1)}function $t(n,t,e){e=e!==void 0?e:v(n,1,n.cols());for(let r=0;r<n.cols();r++)e.set(t(x(n,r),r),0,r);return e}function Vt(n,t){for(let e=0;e<n.cols();e++)t(x(n,e),e);return n}function mt(n){return Nt(n)}function Nt(n){return Math.sqrt(Ht(n))}function Ht(n){return B(n,(t,e)=>t+e*e,0)}var xn=Nt;function Tn(n){return B(n,(t,e)=>t+Math.abs(e),0)}function An(n){return B(n,(t,e)=>Math.max(t,Math.abs(e)),0)}function zt(n,t){let e=mt(n);return t=t!==void 0?t:N(n),rt(n,1/e,t)}function te(n,t,e){e=e!==void 0?e:v(n,n.rows(),1);for(let r=0;r<n.rows();r++)e.set(t(D(n,r),r),r,0);return e}function Dn(n,t){for(let e=0;e<n.rows();e++)t(D(n,e),e);return n}function R(n,t){if(n.rows()!==t.rows()||n.cols()!==t.cols())throw new Error("Insertion failed: Source and target have different sizes");let e=n.cols(),r=t.rows();for(let o=0;o<e;o++)for(let s=0;s<r;s++)n.set(t.at(s,o),s,o);return n}function Dt(n,t,e){let r=N(D(n,t));return R(D(n,t),D(n,e)),R(D(n,e),r),n}function Ln(n,t,e){let r=N(x(n,t));return R(x(n,t),x(n,e)),R(x(n,e),r),n}function qn(n){if(n.rows()!==n.cols())throw new Error("Determinant only defined for square sources");if(n.det&&n.det instanceof Function)return n.det();let t=n.rows();if(t===1)return n.at(0,0);if(t===2)return n.at(0,0)*n.at(1,1)-n.at(0,1)*n.at(1,0);if(t===3){let e=n.at(0,0),r=n.at(0,1),o=n.at(0,2),s=n.at(1,0),i=n.at(1,1),a=n.at(1,2),f=n.at(2,0),d=n.at(2,1),l=n.at(2,2);return e*i*l+r*a*f+o*s*d-o*i*f-r*s*l-e*a*d}else{let e=St(n);if(!e)return 0;let r=(e.numSwaps%2===0?1:-1)*B(K(e.U),(o,s)=>o*s);return isNaN(r)&&(r=0),r}}function Ct(n,t,e){let r=n.rows(),o=n.cols(),s=t.rows(),i=t.cols();if(r!==o)throw new Error("Lower triagonal matrix not square");if(r!==s)throw new Error("b does not have correct size");e=e!==void 0?e:v(t);for(let a=0;a<i;a++)for(let f=0;f<r;f++){let d=0;for(let l=0;l<f;l++)d+=n.at(f,l)*e.at(l,a);e.set((t.at(f,a)-d)/n.at(f,f),f,a)}return e}function Ot(n,t,e){let r=n.rows(),o=n.cols(),s=t.rows(),i=t.cols();if(r!==o)throw new Error("Lower triagonal matrix not square");if(r!==s)throw new Error("b does not have correct size");e=e!==void 0?e:v(t);for(let a=0;a<i;a++)for(let f=r-1;f>=0;f--){let d=0;for(let l=r-1;l>f;l--)d+=n.at(f,l)*e.at(l,a);e.set((t.at(f,a)-d)/n.at(f,f),f,a)}return e}function ee(n){return n.rows()===n.cols()}function ne(n,t,e){if(n.solve&&n.solve instanceof Function)return n.solve(t,e);if(ee(n)){let o=St(n);return o?o.solve(t,e):ht(n).solve(t,e)}return ht(n).solve(t,e)}function re(n,t,e){let r=V(n.P,t),o=Ct(n.L,r);return Ot(n.U,o,e)}function se(n,t,e){let r=n.U,o=n.V,s=n.S,i=o.rows(),a=t.cols(),f=0;e=e!==void 0?e:v(t,i,a),wt(e);for(let d=0;d<a;d++){let l=x(t,d),M=x(e,d);for(f=0;f<s.rows();f++){let p=s.at(f);if(p<=1e-7)break;let y=ut(x(r,f),l)/p;jt(M,rt(x(o,f),y),M)}}return e}function Fn(n){if(n.rows()!==n.cols())throw new Error("Inverse only defined for square sources");if(n.inv&&n.inv instanceof Function)return n.inv();let t=n.rows();if(t===1)return v(n).set(1/n.at(0,0),0,0);if(t===2){let e=n.at(0,0),r=n.at(0,1),o=n.at(1,0),s=n.at(1,1),i=1/(e*s-r*o),a=v(n);return a.set(i*s,0,0),a.set(i*e,1,1),a.set(-i*o,1,0),a.set(-i*r,0,1),a}else if(t===3){let e=n.at(0,0),r=n.at(0,1),o=n.at(0,2),s=n.at(1,0),i=n.at(1,1),a=n.at(1,2),f=n.at(2,0),d=n.at(2,1),l=n.at(2,2),p=1/(e*i*l+r*a*f+o*s*d-o*i*f-r*s*l-e*a*d),y=i*l-a*d,_=-(s*l-a*f),b=s*d-i*f,E=-(r*l-o*d),g=e*l-o*f,k=-(e*d-r*f),P=r*a-o*i,h=-(e*a-o*s),w=e*i-r*s,c=v(n);return c.set(p*y,0,0),c.set(p*_,1,0),c.set(p*b,2,0),c.set(p*E,0,1),c.set(p*g,1,1),c.set(p*k,2,1),c.set(p*P,0,2),c.set(p*h,1,2),c.set(p*w,2,2),c}else{let e=L.newFromMat(n).id(t);return ne(n,e)}}var Rt=class n{constructor(t,e,r,o){this.P=t,this.L=e,this.U=r,this.numSwaps=o}static new(t,e,r,o){return new n(t,e,r,o)}static compute(t,e){return St(t,e)}solve(t,e){return re(this,t,e)}toMat(t){var e=this.P.rows(),r=this.U.cols();if(t=t!==void 0?t:v(this.U,e,r),t.rows()!==e||t.cols()!==r)throw new Error("Output has wrong size");return V(Q(this.P),V(this.L,this.U),t)}};function St(n,t=v(n)){let e=n.rows(),r=n.cols(),o=Math.min(n.rows(),n.cols()),s=z.new(Int32Array).uninitialized(e,1);tt(s,(p,y)=>y,s),R(t,n);let i=0;for(let p=0;p<o;p++){let y=p,_=Math.abs(t.at(y,p));for(let g=p+1;g<e;g++)Math.abs(t.at(g,p))>_&&(y=g,_=Math.abs(t.at(g,p)));y!==p&&(i++,Dt(s,y,p),Dt(t,y,p));let b=t.at(p,p);if(Math.abs(b)<1e-7)return null;let E=S(x(t,p),p+1);if(rt(E,1/b,E),p<r){let g=qt(D(t,p),p+1);for(let k=p+1;k<e;k++){let P=qt(D(t,k),p+1),h=t.at(k,p);bt(P,rt(g,h),P)}}}let a=C(t,0,0,n.rows(),o),f=C(t,0,0,o,n.cols()),d=pt.new(a,A.UNIT_LOWER),l=pt.new(f,A.UPPER),M=kt.new(ct(s),s.rows(),s.rows(),n.type());return Rt.new(M,d,l,i)}function rt(n,t,e){e=e!==void 0?e:v(n);for(let r=0;r<n.cols();r++)for(let o=0;o<n.rows();o++)e.set(n.at(o,r)*t,o,r);return e}function nt(n,t){let e=Math.abs(n),r=Math.abs(t),o=s=>s*s;return e>r?e*Math.sqrt(1+o(r/e)):r===0?0:r*Math.sqrt(1+o(e/r))}function Lt(n,t){if(!X(n))throw new Error("Householder transform needs to operate on vector");let e=t!==void 0?t:N(n),r=n.rows(),o=0;for(let l=1;l<r;l++){let M=n.at(l);o+=M*M}let s=n.at(0);if(e.set(1,0),o===0)return{beta:0,v:e};let i=Math.sqrt(s*s+o);s<=0?e.set(s-i,0):e.set(-o/(s+i),0);let a=e.at(0),f=a*a,d=2*f/(o+f);return rt(e,1/a,e),{beta:d,v:e}}function ut(n,t){let e=n.rows(),r=n.cols();if(e!==t.rows()||r!==t.cols())throw new Error("Inputs must match in size for dot product");let o=0;for(let s=0;s<r;s++)for(let i=0;i<e;i++)o+=n.at(i,s)*t.at(i,s);return o}function S(n,t,e){if(!X(n))throw new Error("Input for subvec needs to be a vector");return e=e!==void 0?e:n.rows()-t,C(n,t,0,e,1)}function qt(n,t,e){if(!Yt(n))throw new Error("Input for subvec needs to be a row vector");return e=e!==void 0?e:n.cols()-t,C(n,0,t,1,e)}function Bt(n,t,e,r){if(r=r!==void 0?r:N(e),n===0)return r;let o=e.rows(),s=e.cols();for(let i=0;i<s;i++){let a=x(r,i),f=a.at(0);f+=ut(S(t,1),S(a,1));let d=n*f;{let l=a.at(0);a.set(l-n*f,0)}for(let l=1;l<o;l++)a.set(a.at(l)-d*t.at(l),l)}return r}function Wt(n,t,e,r){if(r=r!==void 0?r:N(e),n===0)return r;let o=e.rows(),s=e.cols();for(let i=0;i<o;i++){let a=Q(D(r,i)),f=a.at(0);f+=ut(S(t,1),S(a,1));let d=n*f;{let l=a.at(0);a.set(l-n*f,0)}for(let l=1;l<s;l++)a.set(a.at(l)-d*t.at(l),l)}return r}function Nn(n,t){let e=n.rows(),r=n.cols();if(e<r)throw new Error("Biadiagonal only implemented for M >= N");t!==void 0?(R(t,n),n=t):n=N(n);for(let o=0;o<r;o++){let s=S(x(n,o),o),i=Lt(s),a=C(n,o,o,e-o,r-o);if(Bt(i.beta,i.v,a,a),R(S(s,1),S(i.v,1,e-o-1)),o<r-2){let f=S(Q(D(n,o)),o+1),d=C(n,o,o+1,e-o,r-(o+1)),l=Lt(f);Wt(l.beta,l.v,d,d),R(S(f,1),S(l.v,1,r-o-2))}}return n}var Pt=class n{constructor(t,e,r){this.U=t,this.Vt=e,this.B=r}static new(t,e,r){return new n(t,e,r)}};function Cn(n){let t=n.rows(),e=n.cols(),r=z.newFromMat(n),o=r.zeros(n.rows(),n.cols());R(K(o),K(n));for(let f=0;f<e-1;f++)o.set(n.at(f,f+1),f,f+1);let s=r.zeros(t,t);gt(S(K(s),0,e),1);let i=r.zeros(t,1);for(let f=e-1;f>=0;f--){let d=S(i,f);d.set(1,0);let l=S(x(n,f),f),M=S(l,1);R(S(d,1),M);let p=ut(M,M),y=p===0?0:2/(1+p),_=C(s,f,f,t-f,e-f);Bt(y,d,_,_)}let a=r.id(e);i=r.zeros(e-1,1);for(let f=e-3;f>=0;f--){let d=S(i,f);d.set(1,0);let l=S(Q(D(n,f)),f+1),M=S(l,1);R(S(d,1),M);let p=ut(M,M),y=p===0?0:2/(1+p),_=C(a,f+1,f+1,e-(f+1),e-(f+1));Wt(y,d,_,_)}return Pt.new(s,a,o)}function oe(n,t=0){let e=n.rows();if(e!==n.cols())return!1;for(let r=0;r<e;r++)for(let o=0;o<e;o++)if(Math.abs(n.at(o,r)-n.at(r,o))>t)return!1;return!0}function ie(n,t,e){let r=n.rows();for(let o=0;o<r;o++)t[o]=n.at(r-1,o);for(let o=r-1;o>0;o--){let s=0,i=0;for(let a=0;a<o;a++)s=s+Math.abs(t[a]);if(s===0){e[o]=t[o-1];for(let a=0;a<o;a++)t[a]=n.at(o-1,a),n.set(0,o,a),n.set(0,a,o)}else{for(let l=0;l<o;l++)t[l]/=s,i+=t[l]*t[l];let a=t[o-1],f=Math.sqrt(i);a>0&&(f=-f),e[o]=s*f,i=i-a*f,t[o-1]=a-f;for(let l=0;l<o;l++)e[l]=0;for(let l=0;l<o;l++){a=t[l],n.set(a,l,o),f=e[l]+n.at(l,l)*a;for(let M=l+1;M<=o-1;M++)f+=n.at(M,l)*t[M],e[M]+=n.at(M,l)*a;e[l]=f}a=0;for(let l=0;l<o;l++)e[l]/=i,a+=e[l]*t[l];let d=a/(i+i);for(let l=0;l<o;l++)e[l]-=d*t[l];for(let l=0;l<o;l++){a=t[l],f=e[l];for(let M=l;M<=o-1;M++)n.set(n.at(M,l)-(a*e[M]+f*t[M]),M,l);t[l]=n.at(o-1,l),n.set(0,o,l)}}t[o]=i}for(let o=0;o<r-1;o++){n.set(n.at(o,o),r-1,o),n.set(1,o,o);let s=t[o+1];if(s!=0){for(let i=0;i<=o;i++)t[i]=n.at(i,o+1)/s;for(let i=0;i<=o;i++){let a=0;for(let f=0;f<=o;f++)a+=n.at(f,o+1)*n.at(f,i);for(let f=0;f<=o;f++)n.set(n.at(f,i)-a*t[f],f,i)}}for(let i=0;i<=o;i++)n.set(0,i,o+1)}for(let o=0;o<r;o++)t[o]=n.at(r-1,o),n.set(0,r-1,o);n.set(1,r-1,r-1),e[0]=0}function Mt(n,t,e,r){let o,s,i,a;return Math.abs(e)>Math.abs(r)?(o=r/e,s=e+o*r,i=(n+o*t)/s,a=(t-o*n)/s):(o=e/r,s=r+o*e,i=(o*n+t)/s,a=(o*t-n)/s),[i,a]}function ae(n,t,e,r){let o=n.rows(),s=o-1,i=0,a=o-1,f=Math.pow(2,-52),d=0,l=0,M=0,p=0,y=0,_=0,b,E,g,k,P=0;for(let w=0;w<o;w++){w<i|w>a&&(e[w]=t.at(w,w),r[w]=0);for(let c=Math.max(w-1,0);c<o;c++)P=P+Math.abs(t.at(w,c))}let h=0;for(;s>=i;){let w=s;for(;w>i&&(y=Math.abs(t.at(w-1,w-1))+Math.abs(t.at(w,w)),y===0&&(y=P),!(Math.abs(t.at(w,w-1))<f*y));)w--;if(w===s)t.set(t.at(s,s)+d,s,s),e[s]=t.at(s,s),r[s]=0,s--,h=0;else if(w===s-1){if(E=t.at(s,s-1)*t.at(s-1,s),l=(t.at(s-1,s-1)-t.at(s,s))/2,M=l*l+E,_=Math.sqrt(Math.abs(M)),t.set(t.at(s,s)+d,s,s),t.set(t.at(s-1,s-1)+d,s-1,s-1),g=t.at(s,s),M>=0){l>=0?_=l+_:_=l-_,e[s-1]=g+_,e[s]=e[s-1],_!==0&&(e[s]=g-E/_),r[s-1]=0,r[s]=0,g=t.at(s,s-1),y=Math.abs(g)+Math.abs(_),l=g/y,M=_/y,p=Math.sqrt(l*l+M*M),l=l/p,M=M/p;for(let c=s-1;c<o;c++)_=t.at(s-1,c),t.set(M*_+l*t.at(s,c),s-1,c),t.set(M*t.at(s,c)-l*_,s,c);for(let c=0;c<=s;c++)_=t.at(c,s-1),t.set(M*_+l*t.at(c,s),c,s-1),t.set(M*t.at(c,s)-l*_,c,s);for(let c=i;c<=a;c++)_=n.at(c,s-1),n.set(M*_+l*n.at(c,s),c,s-1),n.set(M*n.at(c,s)-l*_,c,s)}else e[s-1]=g+l,e[s]=g+l,r[s-1]=_,r[s]=-_;s=s-2,h=0}else{if(g=t.at(s,s),k=0,E=0,w<s&&(k=t.at(s-1,s-1),E=t.at(s,s-1)*t.at(s-1,s)),h===10){d+=g;for(let u=i;u<=s;u++)t.set(t.at(u,u)-g,u,u);y=Math.abs(t.at(s,s-1))+Math.abs(t.at(s-1,s-2)),g=k=.75*y,E=-.4375*y*y}if(h===30&&(y=(k-g)/2,y=y*y+E,y>0)){y=Math.sqrt(y),k<g&&(y=-y),y=g-E/((k-g)/2+y);for(let u=i;u<=s;u++)t.set(t.at(u,u)-y,u,u);d+=y,g=k=E=.964}h=h+1;let c=s-2;for(;c>=w&&(_=t.at(c,c),p=g-_,y=k-_,l=(p*y-E)/t.at(c+1,c)+t.at(c,c+1),M=t.at(c+1,c+1)-_-p-y,p=t.at(c+2,c+1),y=Math.abs(l)+Math.abs(M)+Math.abs(p),l=l/y,M=M/y,p=p/y,!(c===w||Math.abs(t.at(c,c-1))*(Math.abs(M)+Math.abs(p))<f*(Math.abs(l)*(Math.abs(t.at(c-1,c-1))+Math.abs(_)+Math.abs(t.at(c+1,c+1))))));)c--;for(let u=c+2;u<=s;u++)t.set(0,u,u-2),u>c+2&&t.set(0,u,u-3);for(let u=c;u<=s-1;u++){let j=u!==s-1;if(u!=c){if(l=t.at(u,u-1),M=t.at(u+1,u-1),p=j?t.at(u+2,u-1):0,g=Math.abs(l)+Math.abs(M)+Math.abs(p),g===0)continue;l=l/g,M=M/g,p=p/g}if(y=Math.sqrt(l*l+M*M+p*p),l<0&&(y=-y),y!=0){u!=c?t.set(-y*g,u,u-1):w!=c&&t.set(-t.at(u,u-1),u,u-1),l=l+y,g=l/y,k=M/y,_=p/y,M=M/l,p=p/l;for(let m=u;m<o;m++)l=t.at(u,m)+M*t.at(u+1,m),j&&(l=l+p*t.at(u+2,m),t.set(t.at(u+2,m)-l*_,u+2,m)),t.set(t.at(u,m)-l*g,u,m),t.set(t.at(u+1,m)-l*k,u+1,m);for(let m=0;m<=Math.min(s,u+3);m++)l=g*t.at(m,u)+k*t.at(m,u+1),j&&(l=l+_*t.at(m,u+2),t.set(t.at(m,u+2)-l*p,m,u+2)),t.set(t.at(m,u)-l,m,u),t.set(t.at(m,u+1)-l*M,m,u+1);for(let m=i;m<=a;m++)l=g*n.at(m,u)+k*n.at(m,u+1),j&&(l=l+_*n.at(m,u+2),n.set(n.at(m,u+2)-l*p,m,u+2)),n.set(n.at(m,u)-l,m,u),n.set(n.at(m,u+1)-l*M,m,u+1)}}}}if(P!==0){for(s=o-1;s>=0;s--)if(l=e[s],M=r[s],M===0){let w=s;t.set(1,s,s);for(let c=s-1;c>=0;c--){E=t.at(c,c)-l,p=0;for(let u=w;u<=s;u++)p=p+t.at(c,u)*t.at(u,s);if(r[c]<0)_=E,y=p;else if(w=c,r[c]===0?E!==0?t.set(-p/E,c,s):t.set(-p/(f*P),c,s):(g=t.at(c,c+1),k=t.at(c+1,c),M=(e[c]-l)*(e[c]-l)+r[c]*r[c],b=(g*y-_*p)/M,t.set(b,c,s),Math.abs(g)>Math.abs(_)?t.set((-p-E*b)/g,c+1,s):t.set((-y-k*b)/_,c+1,s)),b=Math.abs(t.at(c,s)),f*b*b>1)for(let u=c;u<=s;u++)t.set(t[u][s]/b,u,s)}}else if(M<0){let w=s-1;if(Math.abs(t.at(s,s-1))>Math.abs(t.at(s-1,s)))t.set(M/t.at(s,s-1),s-1,s-1),t.set(-(t.at(s,s)-l)/t.at(s,s-1),s-1,s);else{let[c,u]=Mt(0,-t.at(s-1,s),t.at(s-1,s-1)-l,M);t.set(c,s-1,s-1),t.set(u,s-1,s)}t.set(0,s,s-1),t.set(1,s,s);for(let c=s-2;c>=0;c--){let u,j,m,q;u=0,j=0;for(let I=w;I<=s;I++)u=u+t.at(c,I)*t.at(I,s-1),j=j+t.at(c,I)*t.at(I,s);if(E=t.at(c,c)-l,r[c]<0)_=E,p=u,y=j;else{if(w=c,r[c]===0){let[I,G]=Mt(-u,-j,E,M);t.set(I,c,s-1),t.set(G,c,s)}else{g=t.at(c,c+1),k=t.at(c+1,c),m=(e[c]-l)*(e[c]-l)+r[c]*r[c]-M*M,q=(e[c]-l)*2*M,m===0&q===0&&(m=f*P*(Math.abs(E)+Math.abs(M)+Math.abs(g)+Math.abs(k)+Math.abs(_)));let[I,G]=Mt(g*p-_*u+M*j,g*y-_*j-M*u,m,q);if(t.set(I,c,s-1),t.set(G,c,s),Math.abs(g)>Math.abs(_)+Math.abs(M))t.set((-u-E*t.at(c,s-1)+M*t.at(c,s))/g,c+1,s-1),t.set((-j-E*t.at(c,s)-M*t.at(c,s-1))/g,c+1,s);else{let[lt,et]=Mt(-p-k*t[c][s-1],-y-k*t[c][s],_,M);t.set(lt,c+1,s-1),t.set(et,c+1,s)}}if(b=Math.max(Math.abs(t.at(c,s-1)),Math.abs(t.at(c,s))),f*b*b>1)for(let I=c;I<=s;I++)t.set(t.at(I,s-1)/b,I,s-1),t.set(t.at(I,s)/b,I,s)}}}for(let w=0;w<o;w++)if(w<i|w>a)for(let c=w;c<o;c++)n.set(t.at(w,c),w,c);for(let w=o-1;w>=i;w--)for(let c=i;c<=a;c++){_=0;for(let u=i;u<=Math.min(w,a);u++)_=_+n.at(c,u)*t.at(u,w);n.set(_,c,w)}}}function ce(n,t,e){let r=n.rows();for(let a=1;a<r;a++)e[a-1]=e[a];e[r-1]=0;let o=0,s=0,i=Math.pow(2,-52);for(let a=0;a<r;a++){s=Math.max(s,Math.abs(t[a])+Math.abs(e[a]));let f=a;for(;f<r&&!(Math.abs(e[f])<=i*s);)f++;if(f>a){let d=0;do{d=d+1;let l=t[a],M=(t[a+1]-l)/(2*e[a]),p=nt(M,1);M<0&&(p=-p),t[a]=e[a]/(M+p),t[a+1]=e[a]*(M+p);let y=t[a+1],_=l-t[a];for(let w=a+2;w<r;w++)t[w]-=_;o=o+_,M=t[f];let b=1,E=b,g=b,k=e[a+1],P=0,h=0;for(let w=f-1;w>=a;w--){g=E,E=b,h=P,l=b*e[w],_=b*M,p=nt(M,e[w]),e[w+1]=P*p,P=e[w]/p,b=M/p,M=b*t[w]-P*l,t[w+1]=_+P*(b*l+P*t[w]);for(let c=0;c<r;c++)_=n.at(c,w+1),n.set(P*n.at(c,w)+b*_,c,w+1),n.set(b*n.at(c,w)-P*_,c,w)}M=-P*h*g*k*e[a]/y,e[a]=P*M,t[a]=b*M}while(Math.abs(e[a])>i*s)}t[a]=t[a]+o,e[a]=0}for(let a=0;a<r-1;a++){let f=a,d=t[a];for(let l=a+1;l<r;l++)t[l]<d&&(f=l,d=t[l]);if(f!=a){t[f]=t[a],t[a]=d;for(let l=0;l<r;l++)d=n.at(l,a),n.set(n.at(l,f),l,a),n.set(d,l,f)}}}function le(n,t){let e=n.rows(),r=0,o=e-1,s=n.type(),i=new s(e);for(let a=r+1;a<=o-1;a++){let f=0;for(let d=a;d<=o;d++)f=f+Math.abs(t.at(d,a-1));if(f!==0){let d=0;for(let M=o;M>=a;M--)i[M]=t.at(M,a-1)/f,d+=i[M]*i[M];let l=Math.sqrt(d);i[a]>0&&(l=-l),d=d-i[a]*l,i[a]=i[a]-l;for(let M=a;M<e;M++){let p=0;for(let y=o;y>=a;y--)p+=i[y]*t.at(y,M);p=p/d;for(let y=a;y<=o;y++)t.set(t.at(y,M)-p*i[y],y,M)}for(let M=0;M<=o;M++){let p=0;for(let y=o;y>=a;y--)p+=i[y]*t.at(M,y);p=p/d;for(let y=a;y<=o;y++)t.set(t.at(M,y)-p*i[y],M,y)}i[a]=f*i[a],t.set(f*l,a,a-1)}}for(let a=0;a<e;a++)for(let f=0;f<e;f++)n.set(a===f?1:0,a,f);for(let a=o-1;a>=r+1;a--)if(t.at(a,a-1)!==0){for(let f=a+1;f<=o;f++)i[f]=t.at(f,a-1);for(let f=a;f<=o;f++){let d=0;for(let l=a;l<=o;l++)d+=i[l]*n.at(l,f);d=d/i[a]/t.at(a,a-1);for(let l=a;l<=o;l++)n.set(n.at(l,f)+d*i[l],l,f)}}}var yt=class n{constructor(t,e,r){this.V=t,this.d=e,this.e=r}static new(t,e,r){return new n(t,e,r)}static compute(t){return fe(t)}getV(){return this.V}getRealEigenvalues(){return this.d}getImaginaryEigenvalues(){return this.e}getD(){let t=wt(v(this.V)),e=this.d,r=this.e,o=e.length;R(K(t),$.from(e));for(let s=0;s<o;s++)r[s]>0?t.set(r[s],s,s+1):r[s]<0&&t.set(r[s],s,s-1);return t}};function fe(n){let t=n.cols();if(t!==n.rows())throw new Error("Eigenvalues only defined for square matrices");let e=n.type(),r=new e(t),o=new e(t);if(oe(n)){let s=N(n);return ie(s,r,o),ce(s,r,o),yt.new(s,r,o)}else{let s=v(n),i=N(n);return le(s,i),ae(s,i,r,o),yt.new(s,r,o)}}var _t=class n{constructor(t,e,r){this.U=t,this.S=e,this.V=r,this.Vt=Q(this.V)}static new(t,e,r){return new n(t,e,r)}static compute(t){return ht(t)}solve(t,e){return se(this,t,e)}toMat(t){let e=this.U,r=this.Vt,o=this.S,s=e.rows(),i=r.cols();if(t=t!==void 0?t:v(e,s,i),t.rows()!==s||t.cols()!==i)throw new Error("Output matrix has wrong dimensions");return V(e,V(ot.new(ct(o),e.cols(),r.rows()),r),t),t}inv(){let t=N(this.U),e=N(this.V),r=N(this.S);for(let o=0;o<r.rows();o++){let s=r.at(o);if(s<1e-7)break;r.set(1/s,o)}return n.new(e,r,t)}};function ht(n){let t=!1;n.rows()<n.cols()&&(n=Q(n),t=!0),n=N(n);let e=n.rows(),r=n.cols(),o=Math.min(e,r),s=n.type(),i=new s(Math.min(e+1,r)),a=v(n,e,o),f=v(n,r,r),d=new s(r),l=new s(e),M=!0,p=!0,y=Math.min(e-1,r),_=Math.max(0,Math.min(r-2,e));for(let h=0;h<Math.max(y,_);h++){if(h<y){i[h]=0;for(let w=h;w<e;w++)i[h]=nt(i[h],n.at(w,h));if(i[h]!=0){n.at(h,h)<0&&(i[h]=-i[h]);for(let w=h;w<e;w++)n.set(n.at(w,h)/i[h],w,h);n.set(n.at(h,h)+1,h,h)}i[h]=-i[h]}for(let w=h+1;w<r;w++){if(h<y&i[h]!=0){let c=0;for(let u=h;u<e;u++)c+=n.at(u,h)*n.at(u,w);c=-c/n.at(h,h);for(let u=h;u<e;u++)n.set(n.at(u,w)+c*n.at(u,h),u,w)}d[w]=n.at(h,w)}if(M&h<y)for(let w=h;w<e;w++)a.set(n.at(w,h),w,h);if(h<_){d[h]=0;for(let w=h+1;w<r;w++)d[h]=nt(d[h],d[w]);if(d[h]!=0){d[h+1]<0&&(d[h]=-d[h]);for(let w=h+1;w<r;w++)d[w]/=d[h];d[h+1]+=1}if(d[h]=-d[h],h+1<e&d[h]!=0){for(let w=h+1;w<e;w++)l[w]=0;for(let w=h+1;w<r;w++)for(let c=h+1;c<e;c++)l[c]+=d[w]*n.at(c,w);for(let w=h+1;w<r;w++){let c=-d[w]/d[h+1];for(let u=h+1;u<e;u++)n.set(n.at(u,w)+c*l[u],u,w)}}if(p)for(let w=h+1;w<r;w++)f.set(d[w],w,h)}}let b=Math.min(r,e+1);if(y<r&&(i[y]=n.at(y,y)),e<b&&(i[b-1]=0),_+1<b&&(d[_]=n.at(_,b-1)),d[b-1]=0,M){for(let h=y;h<o;h++){for(let w=0;w<e;w++)a.set(0,w,h);a.set(1,h,h)}for(let h=y-1;h>=0;h--)if(i[h]!=0){for(let w=h+1;w<o;w++){let c=0;for(let u=h;u<e;u++)c+=a.at(u,h)*a.at(u,w);c=-c/a.at(h,h);for(let u=h;u<e;u++)a.set(a.at(u,w)+c*a.at(u,h),u,w)}for(let w=h;w<e;w++)a.set(-a.at(w,h),w,h);a.set(1+a.at(h,h),h,h);for(let w=0;w<h-1;w++)a.set(0,w,h)}else{for(let w=0;w<e;w++)a.set(0,w,h);a.set(1,h,h)}}if(p)for(let h=r-1;h>=0;h--){if(h<_&d[h]!=0)for(let w=h+1;w<o;w++){let c=0;for(let u=h+1;u<r;u++)c+=f.at(u,h)*f.at(u,w);c=-c/f.at(h+1,h);for(let u=h+1;u<r;u++)f.set(f.at(u,w)+c*f.at(u,h),u,w)}for(let w=0;w<r;w++)f.set(0,w,h);f.set(1,h,h)}let E=b-1,g=0,k=Math.pow(2,-52),P=Math.pow(2,-966);for(;b>0;){let h,w;for(h=b-2;h>=-1&&h!==-1;h--)if(Math.abs(d[h])<=P+k*(Math.abs(i[h])+Math.abs(i[h+1]))){d[h]=0;break}if(h===b-2)w=4;else{let c;for(c=b-1;c>=h&&c!==h;c--){let u=(c!=b?Math.abs(d[c]):0)+(c!=h+1?Math.abs(d[c-1]):0);if(Math.abs(i[c])<=P+k*u){i[c]=0;break}}c===h?w=3:c===b-1?w=1:(w=2,h=c)}switch(h++,w){case 1:{let c=d[b-2];d[b-2]=0;for(let u=b-2;u>=h;u--){let j=nt(i[u],c),m=i[u]/j,q=c/j;if(i[u]=j,u!=h&&(c=-q*d[u-1],d[u-1]=m*d[u-1]),p)for(let I=0;I<r;I++)j=m*f.at(I,u)+q*f.at(I,b-1),f.set(-q*f.at(I,u)+m*f.at(I,b-1),I,b-1),f.set(j,I,u)}}break;case 2:{let c=d[h-1];d[h-1]=0;for(let u=h;u<b;u++){let j=nt(i[u],c),m=i[u]/j,q=c/j;if(i[u]=j,c=-q*d[u],d[u]=m*d[u],M)for(let I=0;I<e;I++)j=m*a.at(I,u)+q*a.at(I,h-1),a.set(-q*a.at(I,u)+m*a.at(I,h-1),I,h-1),a.set(j,I,u)}}break;case 3:{let c=Math.max(Math.max(Math.max(Math.max(Math.abs(i[b-1]),Math.abs(i[b-2])),Math.abs(d[b-2])),Math.abs(i[h])),Math.abs(d[h])),u=i[b-1]/c,j=i[b-2]/c,m=d[b-2]/c,q=i[h]/c,I=d[h]/c,G=((j+u)*(j-u)+m*m)/2,lt=u*m*(u*m),et=0;G!=0|lt!=0&&(et=Math.sqrt(G*G+lt),G<0&&(et=-et),et=lt/(G+et));let st=(q+u)*(q-u)+et,at=q*I;for(let U=h;U<b-1;U++){let W=nt(st,at),Y=st/W,Z=at/W;if(U!=h&&(d[U-1]=W),st=Y*i[U]+Z*d[U],d[U]=Y*d[U]-Z*i[U],at=Z*i[U+1],i[U+1]=Y*i[U+1],p)for(let T=0;T<r;T++)W=Y*f.at(T,U)+Z*f.at(T,U+1),f.set(-Z*f.at(T,U)+Y*f.at(T,U+1),T,U+1),f.set(W,T,U);if(W=nt(st,at),Y=st/W,Z=at/W,i[U]=W,st=Y*d[U]+Z*i[U+1],i[U+1]=-Z*d[U]+Y*i[U+1],at=Z*d[U+1],d[U+1]=Y*d[U+1],M&&U<e-1)for(let T=0;T<e;T++)W=Y*a.at(T,U)+Z*a.at(T,U+1),a.set(-Z*a.at(T,U)+Y*a.at(T,U+1),T,U+1),a.set(W,T,U)}d[b-2]=st,g=g+1}break;case 4:{if(i[h]<=0&&(i[h]=i[h]<0?-i[h]:0,p))for(let c=0;c<=E;c++)f.set(-f.at(c,h),c,h);for(;h<E&&!(i[h]>=i[h+1]);){let c=i[h];if(i[h]=i[h+1],i[h+1]=c,p&&h<r-1)for(let u=0;u<r;u++)c=f.at(u,h+1),f.set(f.at(u,h),u,h+1),f.set(c,u,h);if(M&&h<e-1)for(let u=0;u<e;u++)c=a.at(u,h+1),a.set(a.at(u,h),u,h+1),a.set(c,u,h);h++}g=0,b--}break}}return t?_t.new(f,$.from(i),a):_t.new(a,$.from(i),f)}function ue(n,t){if(n.length>=t)return n;for(;n.length<t;)n+=" ";return n}function he(n){let t=tt(n,o=>o.toString(),xt.uninitialized(n.rows(),n.cols())),e=$t(t,o=>B(o,(s,i)=>Math.max(s,i.length),0),z.new(Int16Array).uninitialized(1,n.cols()));tt(t,(o,s,i)=>ue(o,e.at(0,i)),t);let r=te(t,o=>ct(o).join(" "),xt.uninitialized(n.rows(),1));return ct(r).join(`
`)}function On(n){return he(n)}function Bn(n){return{rows:n.rows(),cols:n.cols(),data:ct(n)}}function Wn(){return O}function Yn(n){O=n}function Ft(n,t,e){if(!X(n)||!X(t))throw new Error("Cross product only defined on vectors");if(n.rows()!==3||t.rows()!==3)throw new Error("Cross product only defined in 3D");let r=n.at(0),o=n.at(1),s=n.at(2),i=t.at(0),a=t.at(1),f=t.at(2);return e=e!==void 0?e:v(n),e.set(o*f-s*a,0),e.set(s*i-r*f,1),e.set(r*a-o*i,2),e}function Zn(n,t,e){let r=bt(n,t);zt(r,r);let o=Ft(e,r);zt(o,o);let s=Ft(r,o),i=H(v(n,4,4)),a=C(i,0,0,3,3);R(D(a,0),Q(o)),R(D(a,1),Q(s)),R(D(a,2),Q(r));let f=H(v(n,4,4));return R(C(f,0,3,3,1),Zt(n)),V(i,f)}function we(n,t,e,r,o,s){let i=H(dt(4,4,it));i.set(2/(t-n),0,0),i.set(2/(r-e),1,1),i.set(2/(s-o),2,2);let a=x(i,3);return a.set(-(n+t)/(t-n),0),a.set(-(e+r)/(r-e),1),a.set(-(s+o)/(s-o),2),i}function de(n,t){let e=H(dt(4,4,it));return R(K(e),Qt([n,n,n+t,0],it)),e.set(1,3,2),e.set(-n*t,2,3),e}function Kn(n,t,e,r,o,s){let i=H(dt(4,4,it));return i.set(2*o/(t-n),0,0),i.set(2*o/(r-e),1,1),i.set(-(s+o)/(s-o),2,2),i.set(0,3,3),i.set((n+t)/(t-n),0,2),i.set((e+r)/(r-e),1,2),i.set(-1,3,2),i.set(-2*s*o/(s-o),2,3),i}function Xn(n,t,e,r){let o=e*Math.tan(n*.5),s=o/t,i=we(-o,o,-s,s,e,r),a=H(dt(4,4,it));K(a).set(-1,2);let f=de(e,r);return V(i,V(f,a))}function Gn(n,t,e,r,o){let s=H(dt(4,4,it)),i=K(s);i.set(e/2,0),o?i.set(-r/2,1):i.set(r/2,1),i.set(.5,2);let a=x(s,3);return a.set(e/2+n,0),o?a.set(r/2-t,1):a.set(r/2+t,1),a.set(.5,2),s}function Jn(n){return Vt(n,t=>{rt(t,1/t.at(t.rows()-1),t)}),n}function Qn(n,t=1){let e=wt(v(n,n.rows()+1,n.cols()+1));return R(C(e,0,0,n.rows(),n.cols()),n),e.set(t,n.rows(),n.cols()),e}function $n(n,t=1){if(!X(n))throw new Error("Not a vector");let e=wt(v(n,n.rows()+1));return R(S(e,0,n.rows()),n),e.set(t,n.rows()),e}function Me(n){if(!X(n)||n.rows()!==3)throw new Error("k has to be a 3D vector to compute the cross product matrix");let t=wt(v(n,3,3));return t.set(-n.at(2),0,1),t.set(n.at(2),1,0),t.set(n.at(1),0,2),t.set(-n.at(1),2,0),t.set(-n.at(0),1,2),t.set(n.at(0),2,1),t}function pe(n,t){n=N(n),zt(n,n);var e=Me(n),r=V(e,e);rt(r,1-Math.cos(t),r),rt(e,Math.sin(t),e),jt(e,r,e);var o=jt(e,Jt(3,3),e);return o}function Vn(n,t){let e=pe(n,t),r=H(v(e,4,4));return R(C(r,0,0,3,3),e),r}function Hn(n){return n*Math.PI/180}function tr(n){return n*180/Math.PI}function er(n){if(!X(n)||n.rows()!==3)throw new Error("Translation vector needs to be 3-dimensional");let t=H(v(n,4,4)),e=S(x(t,3),0,3);return R(e,n),t}function nr(n){if(!X(n)||n.rows()!==3)throw new Error("Scaling vector needs to be 3-dimensional");let t=v(n,4,4),e=S(K(t),0,3);return R(e,n),t.set(1,3,3),t}function rr(n,t,e=1e-7){return mt(bt(n,t))<e}function sr(n,t=1e-7){return mt(n)<t}function or(n,t,e,r=O){let o=Math.sin(n);return F.new(r).from([e*o*Math.cos(t),e*o*Math.sin(t),e*Math.cos(n)])}function ir(n){let[t,e,r]=[n.at(0),n.at(1),n.at(2)],o=mt(n),s=Math.atan2(e,t),i=Math.acos(r/o);return{r:o,theta:i,phi:s}}function ar(n,t,e){if(t.length!==n.rows())throw new Error("Row permutation list length is not equal to rows");let r=v(n);for(let o=0;o<r.rows();o++)R(D(r,o),D(n,t[o]));return e!==void 0?R(e,r):e=r,e}function cr(n,t){return bt(t,n)}var lr=$.from([1,0,0]),fr=$.from([0,1,0]),ur=$.from([0,0,1]),hr=$.from([1,0,0,0]),wr=$.from([0,1,0,0]),dr=$.from([0,0,1,0]);export{ft as BlockView,Ut as ColumnView,ot as Diagonal,He as DiagonalAny,$e as DiagonalF32,Ve as DiagonalF64,rn as DiagonalI16,on as DiagonalI32,cn as DiagonalI64,tn as DiagonalI8,sn as DiagonalUI16,an as DiagonalUI32,ln as DiagonalUI64,en as DiagonalUI8,nn as DiagonalUI8Clamped,It as DiagonalView,yt as Eigen,J as Mat,xt as MatAny,Re as MatF32,Pe as MatF64,Ae as MatI16,Le as MatI32,Fe as MatI64,Se as MatI8,De as MatUI16,qe as MatUI32,Ne as MatUI64,xe as MatUI8,Te as MatUI8Clamped,Tt as MinorView,At as PaddedView,kt as RowPermutation,Et as RowView,_t as SVD,vt as TransposeView,A as TriangularMode,pt as TriangularView,L as TypedDiagonalFactory,z as TypedMatFactory,Oe as VecAny,$ as VecF32,Ce as VecF64,Ze as VecI16,Xe as VecI32,Je as VecI64,Be as VecI8,Ke as VecUI16,Ge as VecUI32,Qe as VecUI64,We as VecUI8,Ye as VecUI8Clamped,lr as X,hr as Xh,fr as Y,wr as Yh,ur as Z,dr as Zh,Mn as abs,_n as absSum,jt as add,fn as addScalar,je as any,rr as approxEqual,sr as approxZero,vn as argmax,kn as argmin,pe as axisAngle,Vn as axisAngle4,C as block,ir as cartesianToSpherical,de as centralPerspective,x as col,$t as colreduce,Vt as colwise,fe as computeEigen,St as computePLUD,ht as computeSVD,Nn as computeUBVD,In as cond,yn as convert,N as copy,Ft as cross,Me as crossMatrix,dn as cwiseDiv,wn as cwiseMax,hn as cwiseMin,un as cwiseMult,Hn as deg2rad,qn as det,K as diag,ut as dot,it as f32,ye as f64,gt as fill,Pn as from,cr as fromTo,Kn as frustum,Wn as getDefaultType,Qn as hmat,Jn as homogenize,$n as hvec,me as i16,Ue as i32,ve as i64,_e as i8,Jt as id,R as insert,Fn as inv,oe as isSymmetric,X as isVec,Zn as lookAt,tt as map,dt as mat,Un as max,En as min,V as mult,Zt as neg,mt as norm,Tn as norm1,Nt as norm2,Ht as norm2Squared,xn as normFrobenius,An as normInf,zt as normalize,Rn as ones,ze as optional,we as ortho,ar as permuteRows,Xn as perspective,he as prettyprint,tr as rad2deg,zn as rand,mn as rank,B as reduce,D as row,te as rowreduce,Dn as rowwise,rt as scale,nr as scaling,Yn as setDefaultType,H as setId,pn as setOne,wt as setZero,v as similar,ne as solve,Ct as solveLowerTriagonal,re as solvePLU,se as solveSVD,Ot as solveUpperTriagonal,or as spherical,bn as sqrSum,bt as sub,S as subvec,Kt as sum,Ln as swapCol,Dt as swapRow,ct as toArray,Bn as toJSON,On as toString,gn as trace,er as translation,Q as transpose,Ie as ui16,Ee as ui32,ke as ui64,be as ui8,ge as ui8c,Cn as unpackUBV,Sn as vec,Qt as vecFrom,Gn as viewport,jn as zeros};
