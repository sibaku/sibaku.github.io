(this.webpackJsonpperspective_ruler=this.webpackJsonpperspective_ruler||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){},271:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(95),i=n.n(o),s=(n(103),n(6)),u=n(1),c=(n(104),n(56)),l=n(58),f=n(3),h=n(4),v=Float32Array,d=(Float64Array,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,BigInt64Array,BigUint64Array,v);function p(e,t){return void 0!==e?e:t}var w=function(){function e(t,n,r,a,o){Object(f.a)(this,e),this._data=t,this._rows=n,this._cols=r,this._innerStride=p(a,1),this._outerStride=p(o,this._rows)}return Object(h.a)(e,[{key:"rows",value:function(){return this._rows}},{key:"cols",value:function(){return this._cols}},{key:"index",value:function(e,t){return t=void 0!==t?t:0,this._innerStride*(e+t*this._outerStride)}},{key:"at",value:function(e,t){var n=this.index(e,t);if(n>this._data.length)throw new Error("Trying to access data outside of range");return this._data[n]}},{key:"set",value:function(e,t,n){var r=this.index(t,n);if(r>this._data.length)throw new Error("Trying to access data outside of range");return this._data[r]=e,this}},{key:"type",value:function(){return this._data.constructor}}],[{key:"new",value:function(t,n,r,a,o){return new e(t,n,r,a,o)}}]),e}(),m=function(){function e(t){Object(f.a)(this,e),this._type=t}return Object(h.a)(e,[{key:"uninitialized",value:function(e,t){var n=e*t,r=new this._type(n);return w.new(r,e,t)}},{key:"from",value:function(e,t,n){for(var r=t*n,a=new this._type(r),o=0;o<r;o++)a[o]=e[o];return w.new(a,t,n)}},{key:"fromRows",value:function(e){var t=e.length;if(t<1)throw new Error("At least one row needed");for(var n=e[0].cols(),r=this.uninitialized(t,n),a=0;a<t;a++)fe(Y(r,a),e[a]);return r}},{key:"fromCols",value:function(e){var t=e.length;if(t<1)throw new Error("At least one column needed");for(var n=e[0].rows(),r=this.uninitialized(n,t),a=0;a<t;a++)fe(J(r,a),e[a]);return r}},{key:"all",value:function(e,t,n){for(var r=t*n,a=new this._type(r),o=0;o<r;o++)a[o]=e;return w.new(a,t,n)}},{key:"zeros",value:function(e,t){return this.all(0,e,t)}},{key:"ones",value:function(e,t){return this.all(1,e,t)}},{key:"id",value:function(e,t){t=p(t,e);var n=this.zeros(e,t);return G(H(n),1),n}},{key:"copy",value:function(e){for(var t=e.cols(),n=e.rows(),r=t*n,a=new this._type(r),o=0,i=0;i<t;i++)for(var s=0;s<n;s++)a[o]=e.at(s,i),o++;return w.new(a,n,t)}},{key:"rand",value:function(e,t){for(var n=e,r=t,a=r*n,o=new this._type(a),i=0,s=0;s<r;s++)for(var u=0;u<n;u++)o[i]=Math.random(),i++;return w.new(o,n,r)}}],[{key:"new",value:function(t){return new e(t)}},{key:"newFromMat",value:function(t){return new e(void 0!==t.type&&t.type instanceof Function?t.type():Array)}}]),e}(),y=new m(Float32Array),b=(new m(Float64Array),new m(Array),new m(Int8Array),new m(Uint8Array),new m(Uint8ClampedArray),new m(Int16Array),new m(Uint16Array),new m(Int32Array),new m(Uint32Array),new m(BigInt64Array),new m(BigUint64Array),function(){function e(t){Object(f.a)(this,e),this._type=t,this._factory=m.new(t)}return Object(h.a)(e,[{key:"from",value:function(e,t){return t=p(t,e.length),this._factory.from(e,t,1)}},{key:"uninitialized",value:function(e){return this._factory.uninitialized(e,1)}},{key:"all",value:function(e,t){return this._factory.all(e,t,1)}},{key:"zeros",value:function(e){return this.all(0,e)}},{key:"ones",value:function(e){return this.all(1,e)}},{key:"id",value:function(e){return this._factory.id(e)}},{key:"copy",value:function(e){if(!W(e))throw new Error("Vector factory can't copy from non-vector");return this._factory.copy(e)}},{key:"rand",value:function(e){return this._factory.rand(e,1)}}],[{key:"new",value:function(t){return new e(t)}},{key:"newFromMat",value:function(t){return new e(void 0!==t.type&&t.type instanceof Function?t.type():Array)}}]),e}()),g=new b(Float32Array),k=(new b(Float64Array),new b(Array),new b(Int8Array),new b(Uint8Array),new b(Uint8ClampedArray),new b(Int16Array),new b(Uint16Array),new b(Int32Array),new b(Uint32Array),new b(BigInt64Array),new b(BigUint64Array),function(){function e(t,n,r,a){if(Object(f.a)(this,e),this._data=t,this._rows=void 0!==n?n:this._data.length,this._cols=void 0!==r?r:this._rows,this._stride=void 0!==a?a:1,this._data.length<this._stride*Math.min(this._rows,this._cols))throw new Error("Not enough data for diagonal construction")}return Object(h.a)(e,[{key:"rows",value:function(){return this._rows}},{key:"cols",value:function(){return this._cols}},{key:"at",value:function(e,t){return e!==t?0:this._data[this._stride*e]}},{key:"set",value:function(e,t,n){if(t!==n)throw new Error("Trying to set offdiagonal element of diagonal matrix");return this._data[this._stride*t]=e,this}},{key:"type",value:function(){return this._data.constructor}}],[{key:"new",value:function(t,n,r,a){return new e(t,n,r,a)}},{key:"fromMat",value:function(e,t,n,r){if(!W(e))throw new Error("Diagonal only takes vectors as input");var a=re(e);return this.new(a,t,n,r)}}]),e}()),E=function(){function e(t){Object(f.a)(this,e),this._type=t}return Object(h.a)(e,[{key:"from",value:function(e,t,n){n=p(n,t);for(var r=Math.min(t,n),a=new this._type(r),o=0;o<r;o++)a[o]=e[o];return k.new(a,t,n)}},{key:"uninitialized",value:function(e,t){t=void 0!==t?t:e;var n=Math.min(e,t),r=new this._type(n);return k.new(r,e,t)}},{key:"all",value:function(e,t,n){n=p(n,t);for(var r=Math.min(t,n),a=new this._type(r),o=0;o<r;o++)a[o]=e;return k.new(a,t,n)}},{key:"id",value:function(e,t){return this.all(1,e,t)}},{key:"rand",value:function(e,t){t=void 0!==t?t:e;for(var n=Math.min(e,t),r=new this._type(n),a=0;a<r.length;a++)r[a]=Math.random();return k.new(r,e,t)}}],[{key:"new",value:function(t){return new e(t)}},{key:"newFromMat",value:function(t){return new e(void 0!==t.type&&t.type instanceof Function?t.type():Array)}}]),e}(),O=(new E(Float32Array),new E(Float64Array),new E(Array),new E(Int8Array),new E(Uint8Array),new E(Uint8ClampedArray),new E(Int16Array),new E(Uint16Array),new E(Int32Array),new E(Uint32Array),new E(BigInt64Array),new E(BigUint64Array),function(){function e(t){Object(f.a)(this,e),this._m=t,this._size=Math.min(this._m.rows(),this._m.cols())}return Object(h.a)(e,[{key:"rows",value:function(){return this._size}},{key:"cols",value:function(){return 1}},{key:"at",value:function(e){return this._m.at(e,e)}},{key:"set",value:function(e,t){return this._m.set(e,t,t),this}},{key:"type",value:function(){return this._m.type()}}],[{key:"new",value:function(t){return new e(t)}}]),e}()),j=function(){function e(t,n,r,a,o){Object(f.a)(this,e),this._m=t,this._i=n,this._j=r,this._rows=a,this._cols=o}return Object(h.a)(e,[{key:"rows",value:function(){return this._rows}},{key:"cols",value:function(){return this._cols}},{key:"at",value:function(e,t){return t=void 0!==t?t:0,this._m.at(e+this._i,t+this._j)}},{key:"set",value:function(e,t,n){return n=void 0!==n?n:0,this._m.set(e,t+this._i,n+this._j)}},{key:"type",value:function(){return this._m.type()}}],[{key:"new",value:function(t,n,r,a,o){return new e(t,n,r,a,o)}}]),e}(),C=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e,r){Object(f.a)(this,n);var a=e.rows();return t.call(this,e,0,r,a,1)}return Object(h.a)(n,null,[{key:"new",value:function(e,t){return new n(e,t)}}]),n}(j),S=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e,r){Object(f.a)(this,n);var a=e.cols();return t.call(this,e,r,0,1,a)}return Object(h.a)(n,null,[{key:"new",value:function(e,t){return new n(e,t)}}]),n}(j),_=function(){function e(t){Object(f.a)(this,e),this._m=t}return Object(h.a)(e,[{key:"rows",value:function(){return this._m.cols()}},{key:"cols",value:function(){return this._m.rows()}},{key:"at",value:function(e,t){return t=void 0!==t?t:0,this._m.at(t,e)}},{key:"set",value:function(e,t,n){return n=void 0!==n?n:0,this._m.set(e,n,t)}},{key:"type",value:function(){return this._m.type()}}],[{key:"new",value:function(t){return new e(t)}}]),e}(),x=0,M=1,L=2,z=3,N=4,A=5,D=function(){function e(t,n){Object(f.a)(this,e),this._m=t,this._mode=n}return Object(h.a)(e,[{key:"rows",value:function(){return this._m.rows()}},{key:"cols",value:function(){return this._m.cols()}},{key:"checkIndex",value:function(e,t){return this._mode===x&&e<=t||this._mode===M&&e>=t||(this._mode===L||this._mode===N)&&e<t||(this._mode===z||this._mode===A)&&e>t}},{key:"at",value:function(e,t){switch(this._mode){case x:return e>t?0:this._m.at(e,t);case M:return e<t?0:this._m.at(e,t);case L:return e>=t?0:this._m.at(e,t);case z:return e<=t?0:this._m.at(e,t);case A:return e<t?0:e===t?1:this._m.at(e,t);case N:return e>=t?0:e===t?1:this._m.at(e,t)}}},{key:"set",value:function(e,t,n){if(!this.checkIndex(t,n))throw new Error("Trying to set value outside triangular part");return this._m.set(e,t,n),this}},{key:"type",value:function(){return this._m.type()}},{key:"solve",value:function(e,t){return this._mode===x||this._mode===L||this._mode===N?pe(this,e,t):de(this,e,t)}}],[{key:"new",value:function(t,n){return new e(t,n)}}]),e}(),T=function(){function e(t,n,r,a){Object(f.a)(this,e),this._data=t,this._rows=p(n,this._data.length),this._cols=p(r,this._rows),this._type=p(a,d)}return Object(h.a)(e,[{key:"at",value:function(e,t){return(e=this._data[e])===(t=p(t,0))?1:0}},{key:"set",value:function(){throw new Error("Permuation matrix is immutable")}},{key:"rows",value:function(){return this._cols}},{key:"cols",value:function(){return this._cols}},{key:"type",value:function(){return this._type}}],[{key:"new",value:function(t,n,r,a){return new e(t,n,r,a)}}]),e}(),I=function(){function e(t,n,r,a,o){if(Object(f.a)(this,e),this._m=t,this._rows=n,this._cols=r,this._rows<t.rows()||this._cols<t.cols())throw new Error("Padded View needs to be at least as big as source");this._offDiagonalValue=p(a,0),this._diagonalValue=p(o,1)}return Object(h.a)(e,[{key:"rows",value:function(){return this._rows}},{key:"cols",value:function(){return this._cols}},{key:"at",value:function(e,t){return e<this._m.rows()&&t<this._m.cols()?this._m.at(e,t):e===t?this._diagonalValue:this._offDiagonalValue}},{key:"set",value:function(e,t,n){if(t<this._m.rows()&&n<this._colsm.cols())return this._m.set(e,t,n);throw new Error("Trying to set values in padding")}},{key:"type",value:function(){return this._m.type()}}],[{key:"new",value:function(t,n,r,a,o){return new e(t,n,r,a,o)}}]),e}();function P(e,t,n){return t=void 0!==t?t:e.rows(),n=void 0!==n?n:e.cols(),m.new(e.type()).uninitialized(t,n)}function V(e){return m.new(e.type()).copy(e)}function W(e){return 1===e.cols()}function B(e,t,n){if(e.cols()!==t.cols()||e.rows()!==t.rows())throw new Error("Trying to add input of different sizes");var r=e.rows(),a=e.cols();n=void 0!==n?n:P(e);for(var o=0;o<a;o++)for(var i=0;i<r;i++){var s=e.at(i,o)+t.at(i,o);n.set(s,i,o)}return n}function U(e,t,n){if(e.cols()!==t.cols()||e.rows()!==t.rows())throw new Error("Trying to add input of different sizes");var r=e.rows(),a=e.cols();n=void 0!==n?n:P(e);for(var o=0;o<a;o++)for(var i=0;i<r;i++){var s=e.at(i,o)-t.at(i,o);n.set(s,i,o)}return n}function G(e,t){for(var n=e.rows(),r=e.cols(),a=0;a<r;a++)for(var o=0;o<n;o++)e.set(t,o,a);return e}function R(e,t,n){return ee(e,(function(e,n,r){return Math.min(e,t.at(n,r))}),n)}function F(e,t,n){return ee(e,(function(e,n,r){return Math.max(e,t.at(n,r))}),n)}function H(e){return O.new(e)}function q(e,t,n,r,a){return r=p(r,e.rows()-t),a=p(a,e.cols()-n),j.new(e,t,n,r,a)}function Y(e,t){return S.new(e,t)}function J(e,t){return C.new(e,t)}function K(e,t,n){var r=e.rows(),a=e.cols();if(a!==t.rows())throw new Error("Incompatible matrix dimensions");var o=t.cols();if((n=void 0!==n?n:P(e,r,o)).rows()!==r||n.cols()!==o)throw new Error("Output dimension does not match input");for(var i=0;i<o;i++)for(var s=0;s<r;s++){for(var u=0,c=0;c<a;c++)u+=e.at(s,c)*t.at(c,i);n.set(u,s,i)}return n}function X(e,t){var n=e.rows(),r=e.cols();t=void 0!==t?t:P(e);for(var a=0;a<r;a++)for(var o=0;o<n;o++)t.set(-e.at(o,a),o,a);return t}function Q(e){return G(e,0)}function $(e){for(var t=e.rows(),n=e.cols(),r=0;r<n;r++)for(var a=0;a<t;a++){var o=a===r?1:0;e.set(o,a,r)}return e}function Z(e){return _.new(e)}function ee(e,t,n){var r=e.rows(),a=e.cols();n=void 0!==n?n:P(e);for(var o=0;o<a;o++)for(var i=0;i<r;i++)n.set(t(e.at(i,o),i,o),i,o);return n}function te(e,t,n){var r=void 0===n,a=e.rows(),o=e.cols();if(r&&a*o===0)throw new Error("Calling reduce on empty input without initial value");for(var i=r?e.at(0,0):n,s=0;s<o;s++)for(var u=0;u<a;u++)r?r=!1:i=t(i,e.at(u,s),u,s,e);return i}function ne(e){return te(e,(function(e,t,n,r){return t>e.v&&(e.v=t,e.row=n,e.col=r),e}),{v:-1/0,row:-1,col:-1})}function re(e){for(var t=e.cols(),n=e.rows(),r=[],a=0;a<t;a++)for(var o=0;o<n;o++)r.push(e.at(o,a));return r}function ae(e,t,n){return n=p(n,d),m.new(n).uninitialized(e,t)}function oe(e,t){for(var n=0;n<e.cols();n++)t(J(e,n),n);return e}function ie(e){return se(e)}function se(e){return Math.sqrt(ue(e))}function ue(e){return te(e,(function(e,t){return e+t*t}),0)}function ce(e,t){return be(e,1/ie(e),t=void 0!==t?t:V(e))}function le(e,t,n){n=void 0!==n?n:P(e,e.rows(),1);for(var r=0;r<e.rows();r++)n.set(t(Y(e,r),r),r,0);return n}function fe(e,t){if(e.rows()!==t.rows()||e.cols()!==t.cols())throw new Error("Insertion failed: Source and target have different sizes");for(var n=e.cols(),r=t.rows(),a=0;a<n;a++)for(var o=0;o<r;o++)e.set(t.at(o,a),o,a);return e}function he(e,t,n){var r=V(Y(e,t));return fe(Y(e,t),Y(e,n)),fe(Y(e,n),r),e}function ve(e,t,n){var r=V(J(e,t));return fe(J(e,t),J(e,n)),fe(J(e,n),r),e}function de(e,t,n){var r=e.rows(),a=e.cols(),o=t.rows(),i=t.cols();if(r!==a)throw new Error("Lower triagonal matrix not square");if(r!==o)throw new Error("b does not have correct size");n=void 0!==n?n:P(t);for(var s=0;s<i;s++)for(var u=0;u<r;u++){for(var c=0,l=0;l<u;l++)c+=e.at(u,l)*n.at(l,s);n.set((t.at(u,s)-c)/e.at(u,u),u,s)}return n}function pe(e,t,n){var r=e.rows(),a=e.cols(),o=t.rows(),i=t.cols();if(r!==a)throw new Error("Lower triagonal matrix not square");if(r!==o)throw new Error("b does not have correct size");n=void 0!==n?n:P(t);for(var s=0;s<i;s++)for(var u=r-1;u>=0;u--){for(var c=0,l=r-1;l>u;l--)c+=e.at(u,l)*n.at(l,s);n.set((t.at(u,s)-c)/e.at(u,u),u,s)}return n}function we(e){if(e.rows()!==e.cols())throw new Error("Inverse only defined for square sources");if(e.inv&&e.inv instanceof Function)return e.inv();var t=e.rows();if(1===t)return P(e).set(1/e.at(0,0),0,0);if(2===t){var n=e.at(0,0),r=e.at(0,1),a=e.at(1,0),o=e.at(1,1),i=1/(n*o-r*a),s=P(e);return s.set(i*o,0,0),s.set(i*n,1,1),s.set(-i*a,1,0),s.set(-i*r,0,1),s}if(3===t){var u=e.at(0,0),c=e.at(0,1),l=e.at(0,2),f=e.at(1,0),h=e.at(1,1),v=e.at(1,2),d=e.at(2,0),p=e.at(2,1),w=e.at(2,2),m=1/(u*h*w+c*v*d+l*f*p-l*h*d-c*f*w-u*v*p),y=h*w-v*p,b=-(f*w-v*d),g=f*p-h*d,k=-(c*w-l*p),O=u*w-l*d,j=-(u*p-c*d),C=c*v-l*h,S=-(u*v-l*f),_=u*h-c*f,x=P(e);return x.set(m*y,0,0),x.set(m*b,1,0),x.set(m*g,2,0),x.set(m*k,0,1),x.set(m*O,1,1),x.set(m*j,2,1),x.set(m*C,0,2),x.set(m*S,1,2),x.set(m*_,2,2),x}return function(e,t,n){if(e.solve&&e.solve instanceof Function)return e.solve(t,n);if(function(e){return e.rows()===e.cols()}(e)){var r=ye(e);return r?r.solve(t,n):Ae(e).solve(t,n)}return Ae(e).solve(t,n)}(e,E.newFromMat(e).id(t))}var me=function(){function e(t,n,r,a){Object(f.a)(this,e),this.P=t,this.L=n,this.U=r,this.numSwaps=a}return Object(h.a)(e,[{key:"solve",value:function(e,t){return function(e,t,n){var r=K(e.P,t),a=de(e.L,r);return pe(e.U,a,n)}(this,e,t)}},{key:"toMat",value:function(e){var t=this.P.rows(),n=this.U.cols();if((e=void 0!==e?e:P(this.U,t,n)).rows()!==t||e.cols()!==n)throw new Error("Output has wrong size");return K(Z(this.P),K(this.L,this.U),e)}}],[{key:"new",value:function(t,n,r,a){return new e(t,n,r,a)}}]),e}();function ye(e,t){var n=e.rows(),r=e.cols(),a=Math.min(e.rows(),e.cols()),o=m.new(Int32Array).uninitialized(n,1);ee(o,(function(e,t){return t}),o),void 0===t&&(t=P(e)),fe(t,e);for(var i=0,s=0;s<a;s++){for(var u=s,c=Math.abs(t.at(u,s)),l=s+1;l<n;l++)Math.abs(t.at(l,s))>c&&(u=l,c=Math.abs(t.at(l,s)));u!==s&&(i++,he(o,u,s),he(t,u,s));var f=t.at(s,s);if(Math.abs(f)<1e-7)return null;var h=Oe(J(t,s),s+1);if(be(h,1/f,h),s<r)for(var v=je(Y(t,s),s+1),d=s+1;d<n;d++){var p=je(Y(t,d),s+1);U(p,be(v,t.at(d,s)),p)}}var w=q(t,0,0,e.rows(),a),y=q(t,0,0,a,e.cols()),b=D.new(w,A),g=D.new(y,x),k=T.new(re(o),o.rows(),o.rows(),e.type());return me.new(k,b,g,i)}function be(e,t,n){n=void 0!==n?n:P(e);for(var r=0;r<e.cols();r++)for(var a=0;a<e.rows();a++)n.set(e.at(a,r)*t,a,r);return n}function ge(e,t){var n=Math.abs(e),r=Math.abs(t),a=function(e){return e*e};return n>r?n*Math.sqrt(1+a(r/n)):0===r?0:r*Math.sqrt(1+a(n/r))}function ke(e,t){if(!W(e))throw new Error("Householder transform needs to operate on vector");for(var n=void 0!==t?t:V(e),r=e.rows(),a=0,o=1;o<r;o++){var i=e.at(o);a+=i*i}var s=e.at(0);if(n.set(1,0),0===a)return{beta:0,v:n};var u=Math.sqrt(s*s+a);s<=0?n.set(s-u,0):n.set(-a/(s+u),0);var c=n.at(0),l=c*c,f=2*l/(a+l);return be(n,1/c,n),{beta:f,v:n}}function Ee(e,t){var n=e.rows(),r=e.cols();if(n!==t.rows()||r!==t.cols())throw new Error("Inputs must match in size for dot product");for(var a=0,o=0;o<r;o++)for(var i=0;i<n;i++)a+=e.at(i,o)*t.at(i,o);return a}function Oe(e,t,n){if(!W(e))throw new Error("Input for subvec needs to be a vector");return n=void 0!==n?n:e.rows()-t,q(e,t,0,n,1)}function je(e,t,n){if(1!==e.rows())throw new Error("Input for subvec needs to be a row vector");return n=void 0!==n?n:e.cols()-t,q(e,0,t,1,n)}function Ce(e,t,n,r){if(r=void 0!==r?r:V(n),0===e)return r;for(var a=n.rows(),o=n.cols(),i=0;i<o;i++){var s=J(r,i),u=s.at(0),c=e*(u+=Ee(Oe(t,1),Oe(s,1))),l=s.at(0);s.set(l-e*u,0);for(var f=1;f<a;f++)s.set(s.at(f)-c*t.at(f),f)}return r}function Se(e,t,n,r){if(r=void 0!==r?r:V(n),0===e)return r;for(var a=n.rows(),o=n.cols(),i=0;i<a;i++){var s=Z(Y(r,i)),u=s.at(0),c=e*(u+=Ee(Oe(t,1),Oe(s,1))),l=s.at(0);s.set(l-e*u,0);for(var f=1;f<o;f++)s.set(s.at(f)-c*t.at(f),f)}return r}var _e=function(){function e(t,n,r){Object(f.a)(this,e),this.U=t,this.Vt=n,this.B=r}return Object(h.a)(e,null,[{key:"new",value:function(t,n,r){return new e(t,n,r)}}]),e}();function xe(e,t){var n,r;if(0===t)n=1,r=0;else if(Math.abs(t)>Math.abs(e)){var a=-e/t,o=1/Math.sqrt(1+a*a);r=o,n=o*a}else{var i=-t/e,s=1/Math.sqrt(1+i*i);n=s,r=s*i}return{c:n,s:r}}function Me(e,t,n,r){var a,o,i,s,u,c,l,f=n.rows(),h=r.rows(),v=e.at(0),d=t.at(0),p=e.at(1);if(0!==v)if(0===p){var w=xe(v,d);for(o=w.c,i=w.s,e.set(v*o-d*i,0),t.set(0,0),a=0;a<h;a++){var m=r.at(a,0),y=r.at(a,1);r.set(o*m-i*y,a,0),r.set(i*m+o*y,a,1)}}else{var b,g,k=function(e,t,n){var r,a,o=2*e*t;if(0===e||0===t)return{c:r=1,s:a=0};if(0!==o){var i,s=(t*t+(n+e)*(n-e))/o;a=(i=s>=0?1/(s+ge(1,s)):-1/(-s+ge(1,s)))*(r=1/ge(1,i))}else r=1,a=0;return{c:r,s:a}}(v,d,p);for(s=(o=k.c)*v-(i=k.s)*d,c=-i*p,u=i*v+o*d,l=o*p,a=0;a<h;a++){var E=r.at(a,0),O=r.at(a,1);r.set(o*E-i*O,a,0),r.set(i*E+o*O,a,1)}if(ge(s,c)<ge(u,l))b=s,s=u,u=b,g=c,c=l,l=g,ve(r,0,1);var j=xe(s,c);for(o=j.c,i=j.s,e.set(o*s-i*c,0),t.set(o*u-i*l,0),e.set(i*u+o*l,1),a=0;a<f;a++){var C=n.at(a,0),S=n.at(a,1);n.set(o*C-i*S,a,0),n.set(i*C+o*S,a,1)}}else{var _=xe(d,p);for(o=_.c,i=_.s,e.set(o*d-i*p,0),t.set(i*d+o*p,0),e.set(0,1),a=0;a<f;a++){var x=n.at(a,0),M=n.at(a,1);n.set(o*x-i*M,a,0),n.set(i*x+o*M,a,1)}ve(r,0,1)}}function Le(e,t,n,r){var a,o,i,s,u,c=n.rows(),l=e.rows();for(i=t.at(r),s=e.at(r+1),u=r;u<l-1;u++){var f=xe(s,-i);a=f.c,o=f.s;var h=void 0;for(h=0;h<c;h++){var v=n.at(h,r),d=n.at(h,u+1);n.set(a*v-o*d,h,r),n.set(o*v+a*d,h,u+1)}if(e.set(o*i+a*s,u+1),u===r&&t.set(a*i-o*s,u),u<l-2){var p=t.at(u+1);t.set(a*p,u+1),i=-o*p,s=e.at(u+2)}}}function ze(e,t,n,r){var a,o,i,s,u,c,l,f,h,v,d=n.rows(),p=r.rows(),w=e.rows();if(1!==w)if(2!==w){for(h=0;h<w-1;h++){if(0===e.at(h))return void Le(e,t,n,h)}if(0!==e.at(w-1)){var m=e.at(0),y=t.at(0),b=e.at(1);for(a=m*m-function(e,t){var n=e.rows(),r=e.at(n-2),a=e.at(n-1),o=n>2?t.at(n-3):0,i=t.at(n-2),s=a*a+i*i,u=r*i,c=(r*r+o*o-s)/2;return c>=0?s-u*u/(c+ge(c,u)):s+u*u/(-c+ge(c,u))}(e,t),o=m*y,i=0,s=0,c=m,l=y,f=b,v=0;v<w-1;v++){var g=void 0,k=void 0,E=xe(a,o);for(g=E.c,k=E.s,h=0;h<p;h++){var O=r.at(h,v),j=r.at(h,v+1);r.set(g*O-k*j,h,v),r.set(k*O+g*j,h,v+1)}var C=g*s-k*o,S=g*c-k*l,_=k*c+g*l,x=-k*f,M=g*f;v>0&&t.set(C,v-1),i=S,s=_,u=x,c=M,l=v<w-2?t.at(v+1):0;var L=xe(a=i,o=u);for(g=L.c,k=L.s,h=0;h<d;h++){var z=n.at(h,v),N=n.at(h,v+1);n.set(g*z-k*N,h,v),n.set(k*z+g*N,h,v+1)}var A=g*i-k*u,D=g*s-k*c,T=-k*l,I=k*s+g*c,P=g*l;e.set(A,v),i=A,s=D,u=T,c=I,l=P,f=v<w-2?e.at(v+2):0,a=s,o=u}t.set(s,w-2),e.set(c,w-1)}else!function(e,t,n){var r,a,o,i,s,u=n.rows(),c=e.rows();for(o=e.at(c-2),i=t.at(c-2),s=c-1;s-- >0;){var l=xe(o,i);r=l.c,a=l.s;var f=void 0;for(f=0;f<u;f++){var h=n.at(f,s),v=n.at(f,c-1);n.set(r*h-a*v,f,s),n.set(a*h+r*v,f,c-1)}if(e.set(r*o-a*i,s),s===c-2&&t.set(a*o+r*i,s),s>0){var d=t.at(s-1);t.set(r*d,s-1),o=e.at(s-1),i=a*d}}}(e,t,r)}else Me(e,t,n,r)}var Ne=function(){function e(t,n,r){Object(f.a)(this,e),this.U=t,this.S=n,this.V=r,this.Vt=Z(this.V)}return Object(h.a)(e,[{key:"solve",value:function(e,t){return function(e,t,n){var r=e.U,a=e.V,o=e.S,i=a.rows(),s=t.cols(),u=0;Q(n=void 0!==n?n:P(t,i,s));for(var c=0;c<s;c++){var l=J(t,c),f=J(n,c);for(u=0;u<o.rows();u++){var h=o.at(u);if(h<=1e-7)break;var v=Ee(J(r,u),l)/h;B(f,be(J(a,u),v),f)}}return n}(this,e,t)}},{key:"toMat",value:function(e){var t=this.U,n=this.V,r=this.S,a=t.rows(),o=n.cols();if((e=void 0!==e?e:P(t,a,o)).rows()!==a||e.cols()!==o)throw new Error("Output matrix has wrong dimensions");return K(t,K(k.new(re(r),a,o),Z(n)),e),e}},{key:"inv",value:function(){for(var t=V(this.U),n=V(this.V),r=V(this.S),a=0;a<r.rows();a++){var o=r.at(a);if(o<1e-7)break;r.set(1/o,a)}return e.new(n,r,t)}}],[{key:"new",value:function(t,n,r){return new e(t,n,r)}}]),e}();function Ae(e){var t=!1;e.rows()<e.cols()&&(e=Z(e),t=!0);for(var n=e.rows(),r=e.cols(),a=Math.min(n,r),o=function(e){var t=e.rows(),n=e.cols(),r=m.newFromMat(e),a=r.zeros(e.rows(),e.cols());fe(H(a),H(e));for(var o=0;o<n-1;o++)a.set(e.at(o,o+1),o,o+1);var i=r.zeros(t,t);G(Oe(H(i),0,n),1);for(var s=r.zeros(t,1),u=n-1;u>=0;u--){var c=Oe(s,u);c.set(1,0);var l=Oe(J(e,u),u),f=Oe(l,1);fe(Oe(c,1),f);var h=Ee(f,f),v=0===h?0:2/(1+h),d=q(i,u,u,t-u,n-u);Ce(v,c,d,d)}var p=r.id(n);s=r.zeros(n-1,1);for(var w=n-3;w>=0;w--){var y=Oe(s,w);y.set(1,0);var b=Oe(Z(Y(e,w)),w+1),g=Oe(b,1);fe(Oe(y,1),g);var k=Ee(g,g),E=0===k?0:2/(1+k),O=q(p,w+1,w+1,n-(w+1),n-(w+1));Se(E,y,O,O)}return _e.new(i,p,a)}(function(e,t){var n=e.rows(),r=e.cols();if(n<r)throw new Error("Biadiagonal only implemented for M >= N");void 0!==t?(fe(t,e),e=t):e=V(e);for(var a=0;a<r;a++){var o=Oe(J(e,a),a),i=ke(o),s=q(e,a,a,n-a,r-a);if(Ce(i.beta,i.v,s,s),fe(Oe(o,1),Oe(i.v,1,n-a-1)),a<r-2){var u=Oe(Z(Y(e,a)),a+1),c=q(e,a,a+1,n-a,r-(a+1)),l=ke(u);Se(l.beta,l.v,c,c),fe(Oe(u,1),Oe(l.v,1,r-a-2))}}return e}(e)),i=V(H(o.B)),s=Oe(m.newFromMat(o.B).uninitialized(r,1),1),u=0;u<r-1;u++)s.set(o.B.at(u,u+1),u);!function(e,t){for(var n=e.rows(),r=e.at(0),a=0;a<n-1;a++){var o=t.at(a),i=e.at(a+1);Math.abs(o)<1e-7*(Math.abs(r)+Math.abs(i))&&t.set(0,a),r=i}}(i,s);for(var c,l=V(o.U),f=o.Vt,h=r-1,v=0;h>0;){var d=s.at(h-1);if(0===d||isNaN(d))h--;else{for(c=h-1;c>0;){var p=s.at(c-1);if(0===p||isNaN(p))break;c--}if(++v>100*r)throw new Error("SVD did not converge");var w=h-c+1;ze(Oe(i,c,w),Oe(s,c,w-1),q(l,0,c,l.rows(),w),q(f,0,c,f.rows(),w))}}for(var y=0;y<a;y++){var b=i.at(y);if(b<0){for(var g=0;g<r;g++){var k=f.at(g,y);f.set(-k,g,y)}i.set(-b,y)}}for(var E=0;E<a;E++){var O=ne(Oe(i,E)).row+E;O!==E&&(he(i,E,O),ve(f,E,O),ve(l,E,O))}return t?Ne.new(f,i,l):Ne.new(l,i,f)}function De(e){return{rows:e.rows(),cols:e.cols(),data:re(e)}}function Te(e,t,n){if(!W(e)||!W(t))throw new Error("Cross product only defined on vectors");if(3!==e.rows()||3!==t.rows())throw new Error("Cross product only defined in 3D");var r=e.at(0),a=e.at(1),o=e.at(2),i=t.at(0),s=t.at(1),u=t.at(2);return(n=void 0!==n?n:P(e)).set(a*u-o*s,0),n.set(o*i-r*u,1),n.set(r*s-a*i,2),n}function Ie(e,t){var n=$(ae(4,4,v));return fe(H(n),function(e,t){var n=e.length;return t=p(t,d),m.new(t).copy(w.new(e,n,1))}([e,e,e+t,0],v)),n.set(1,3,2),n.set(-e*t,2,3),n}function Pe(e,t,n,r){var a=n*Math.tan(.5*e),o=a/t,i=function(e,t,n,r,a,o){var i=$(ae(4,4,v));i.set(2/(t-e),0,0),i.set(2/(r-n),1,1),i.set(2/(o-a),2,2);var s=J(i,3);return s.set(-(e+t)/(t-e),0),s.set(-(n+r)/(r-n),1),s.set(-(o+a)/(o-a),2),i}(-a,a,-o,o,n,r),s=$(ae(4,4,v));return H(s).set(-1,2),K(i,K(Ie(n,r),s))}function Ve(e,t,n,r,a){var o=$(ae(4,4,v)),i=H(o);i.set(n/2,0),a?i.set(-r/2,1):i.set(r/2,1),i.set(.5,2);var s=J(o,3);return s.set(n/2+e,0),a?s.set(r/2-t,1):s.set(r/2+t,1),s.set(.5,2),o}function We(e){return oe(e,(function(e){be(e,1/e.at(e.rows()-1),e)})),e}function Be(e,t){if(!W(e))throw new Error("Not a vector");t=p(t,1);var n=Q(P(e,e.rows()+1));return fe(Oe(n,0,e.rows()),e),n.set(t,e.rows()),n}function Ue(e,t){ce(e=V(e),e);var n,r,a,o=function(e){if(!W(e)||3!==e.rows())throw new Error("k has to be a 3D vector to compute the cross product matrix");var t=Q(P(e,3,3));return t.set(-e.at(2),0,1),t.set(e.at(2),1,0),t.set(e.at(1),0,2),t.set(-e.at(1),2,0),t.set(-e.at(0),1,2),t.set(e.at(0),2,1),t}(e),i=K(o,o);return be(i,1-Math.cos(t),i),be(o,Math.sin(t),o),B(o,i,o),B(o,(n=3,r=3,a=p(a,d),E.new(a).id(n,r)),o)}function Ge(e){return e*Math.PI/180}function Re(e){if(!W(e)||3!==e.rows())throw new Error("Translation vector needs to be 3-dimensional");var t=$(P(e,4,4));return fe(Oe(J(t,3),0,3),e),t}function Fe(e){if(!W(e)||3!==e.rows())throw new Error("Scaling vector needs to be 3-dimensional");var t=P(e,4,4);return fe(Oe(H(t),0,3),e),t.set(1,3,3),t}function He(e,t,n,r){var a=Math.sin(e);return r=p(r,d),b.new(r).from([n*a*Math.cos(t),n*a*Math.sin(t),n*Math.cos(e)])}function qe(e){var t=[e.at(0),e.at(1),e.at(2)],n=t[0],r=t[1],a=t[2],o=ie(e),i=Math.atan2(r,n);return{r:o,theta:Math.acos(a/o),phi:i}}function Ye(e,t){return U(t,e)}var Je=g.from([1,0,0]),Ke=g.from([0,1,0]),Xe=g.from([0,0,1]),Qe=(g.from([1,0,0,0]),g.from([0,1,0,0]),g.from([0,0,1,0]),n(59)),$e=n(57),Ze=n(273),et=n(23),tt=function(){var e=0;return function(){return e++}}();function nt(e){return e.toPrecision(10).replace(/(?:\.0+|(\.\d+?)0+)$/,"$1")}function rt(e){this._name=e,this.observers=[]}function at(){this._canvas=null,this._ctx=null,this._w=0,this._h=0,this._screenOrigin=[0,0],this._flip=!0,this.observable=rt.create("Screen")}function ot(e){this.entries=void 0!==e?e:{}}function it(e){return Object.assign({},e)}rt.prototype.name=function(e){return void 0===e?this._name:(this._name=e,this)},rt.create=function(){return Object(et.a)(rt,Array.prototype.slice.call(arguments))},rt.new=rt.create,rt.prototype.observe=function(e){var t=void 0===e.object?null:e.object,n=void 0===e.ctx?e.object:e.ctx,r=void 0===e.func?function(){}:e.func,a=void 0===e.topic?null:e.topic;return this.observers.push({object:t,func:r,ctx:n,topic:a,observableName:this.name()}),this},rt.prototype.remove=function(e){for(var t=0;t<this.observers.length;t++)if(e===this.observers[t].object)return this.observers.splice(t,1),!0;return!1},rt.prototype.notify=function(){for(var e in this.observers){var t,n=this.observers[e],r=arguments.length>0?arguments[0]:{};if(null===n.topic||n.topic===r.type)(t=n.func).call.apply(t,[n.ctx,n].concat(Array.prototype.slice.call(arguments)))}},at.create=function(){return Object(et.a)(at,Array.prototype.slice.call(arguments))},at.new=at.create,at.prototype.screenOrigin=function(e){return void 0===e?this._screenOrigin:(this._screenOrigin=e.concat(),this.updateValues(),this)},at.prototype.pixelWidth=function(){return 1/this.w()},at.prototype.updateValues=function(){this._v=this._u/this._w*this._h;var e=this.screenOrigin();this._flip?this._ctx.setTransform(1,0,0,-1,e[0],this.h()-e[1]):this._ctx.setTransform(1,0,0,1,e[0],e[1]),this.observable.notify({type:"update"})},at.prototype.aspect=function(){return this._w/this._h},at.prototype.canvas=function(e){return"undefined"===typeof e?this._canvas:(this._canvas=e,this._w=this._canvas.width,this._h=this._canvas.height,this._ctx=e.getContext("2d"),this.updateValues(),this)},at.prototype.clear=function(){var e=this.ctx();e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.w(),this.h()),e.restore()},at.prototype.ctx=function(){return this._ctx},at.prototype.flip=function(e){if(void 0===e)return this._flip;this._flip=e,this.updateValues()},at.prototype.w=function(e){return void 0===e?this._w:(this._canvas.width=e,this._w=e,this.updateValues(),this)},at.prototype.h=function(e){return void 0===e?this._h:(this._canvas.height=e,this._h=e,this.updateValues(),this)},at.prototype.toScreen=function(e){var t=this.w(),n=this.h();return[e[0]*t,e[1]*n]},at.prototype.toImage=function(e){var t=this.w(),n=this.h();return[e[0]/t,e[1]/n]},at.prototype.save=function(){this.ctx().save()},at.prototype.restore=function(){this.ctx().restore()},at.prototype.setColor=function(e,t){this.ctx()[e]=t.toString()},ot.new=function(e){return new ot(e)},ot.prototype.get=function(e,t){return e in this.entries?this.entries[e]:t},ot.prototype.toJSON=function(){return this.entries},ot.prototype.set=function(e,t){return this.entries[e]=t,this},ot.prototype.remove=function(e){delete this.entries[e]},ot.prototype.copy=function(){for(var e=this.entries,t=Object.keys(e),n={},r=0;r<t.length;r++){var a=t[r],o=e[a],i=void 0!==o.copy?o.copy():o;n[a]=i}return ot.new(n)},ot.prototype.cp=ot.prototype.copy;var st=2*Math.PI;function ut(e){var t=e.angle,n=e.angleName,r=void 0===n?"alpha":n,o=e.handleChange,i=e.precision,s=void 0===i?2:i,u=e.clockwise,c=void 0===u||u,l=e.angleMin,f=void 0===l?0:l,h=e.angleMax,v=void 0===h?360:h;t=function(e){var t=e%st;return t<0&&(t+=st),t}(t);var d=180*t/Math.PI;d=Math.max(f,Math.min(v,d));var p=v-f,w=(d-f)/p*100;return a.a.createElement("div",null,a.a.createElement("div",null,r," : ",nt(d,s),"[deg]"),a.a.createElement("input",{type:"range",min:"0",max:"100",value:c?100-w:w,className:"angleSlider",onChange:function(e){return o(Ge(function(e){return f+e/100*p}(c?100-Number(e.target.value):Number(e.target.value))))}}))}function ct(e){var t=e.checked,n=e.labelText,o=e.handleChange,i=Object(r.useMemo)((function(){return Object(Ze.a)()}),[]);return a.a.createElement("div",null,a.a.createElement("input",{name:i,type:"checkbox",checked:t,onChange:function(e){return o(e.target.checked)}}),a.a.createElement("label",{htmlFor:i}," ",n))}function lt(e){var t=e.value,n=e.valueName,r=e.handleChange,o=e.min,i=void 0===o?0:o,s=e.max,u=void 0===s?100:s,c=e.step,l=void 0===c?1:c,f=e.precision,h=void 0===f?2:f;return a.a.createElement("div",null,a.a.createElement("div",null,n," : ",nt(t,h)),a.a.createElement("input",{type:"range",min:i,max:u,step:l,value:t,className:"valueSlider",onChange:function(e){r(Number(e.target.value))}}))}function ft(e){var t=e.value,n=e.valueName,o=e.handleChange,i=(e.precision,Object(Qe.a)(e,["value","valueName","handleChange","precision"])),s=Object(r.useState)(0),c=Object(u.a)(s,2),l=c[0],f=c[1];return Object(r.useEffect)((function(){f((function(){return t}))}),[t]),a.a.createElement("div",null,n,a.a.createElement($e.a,Object.assign({value:l,allowEmptyFormatting:!0},i,{onValueChange:function(e){var n=e.floatValue;f(n),n!==t&&o(n)}})))}function ht(e){var t=e.value,n=e.valueName,o=e.handleChange,i=e.timeout,s=void 0===i?1e3:i,u=(e.precision,Object(Qe.a)(e,["value","valueName","handleChange","timeout","precision"])),c=t,l=Object(r.useRef)(null);return a.a.createElement("div",null,n,a.a.createElement($e.a,Object.assign({value:c,allowEmptyFormatting:!0,onValueChange:function(e){return function(e){null!==l.current&&clearTimeout(l.current),l.current=setTimeout((function(){o(e)}),s)}(e.floatValue)}},u)))}function vt(e,t,n){var r=Ye(t,n),a=Ye(e,n),o=Ee(r,a);if(o<=0)return ue(a);var i=Ye(e,t);if((o=Ee(r,i))>=0)return ue(i);var s=Ee(r,r);return ue(U(i,be(r,Ee(i,r)/s)))}function dt(e,t){var n=[];if(n.push(g.from([e.at(3,0)+e.at(0,0),e.at(3,1)+e.at(0,1),e.at(3,2)+e.at(0,2),e.at(3,3)+e.at(0,3)])),n.push(g.from([e.at(3,0)-e.at(0,0),e.at(3,1)-e.at(0,1),e.at(3,2)-e.at(0,2),e.at(3,3)-e.at(0,3)])),n.push(g.from([e.at(3,0)-e.at(1,0),e.at(3,1)-e.at(1,1),e.at(3,2)-e.at(1,2),e.at(3,3)-e.at(1,3)])),n.push(g.from([e.at(3,0)+e.at(1,0),e.at(3,1)+e.at(1,1),e.at(3,2)+e.at(1,2),e.at(3,3)+e.at(1,3)])),n.push(g.from([e.at(3,0)+e.at(2,0),e.at(3,1)+e.at(2,1),e.at(3,2)+e.at(2,2),e.at(3,3)+e.at(2,3)])),n.push(g.from([e.at(3,0)-e.at(2,0),e.at(3,1)-e.at(2,1),e.at(3,2)-e.at(2,2),e.at(3,3)-e.at(2,3)])),t)for(var r=0;r<n.length;r++){var a=ie(Oe(n[r],0,3));be(n[r],1/a)}return n}function pt(e,t,n){for(var r=0;r<2;r++){var a=e.at(r);if(a<t.at(r)||a>n.at(r))return!1}return!0}function wt(e){return[le(e,(function(e){return te(e,(function(e,t){return Math.min(e,t)}))})),le(e,(function(e){return te(e,(function(e,t){return Math.max(e,t)}))}))]}function mt(e,t,n){var r=U(t,e),a=-Ee(n,Be(e,1))/Ee(Be(r,0),n);return[B(e,be(r,a)),a]}function yt(e,t){var n=g.uninitialized(4);return fe(Oe(n,0,3),t),n.set(-Ee(t,e),3),n}function bt(e,t){return K(Z(we(t)),e)}function gt(e,t){return function(e,t){return Math.sign(Ee(Be(e,1),t))}(e,t)>=0}function kt(e){var t=[];return oe(e,(function(e){t.push([e.at(0),e.at(1)])})),t}function Et(e){for(var t=0,n=e.length,r=0;r<n;r++){var a=e[r],o=e[(r+1)%n];t+=(a.at(0)+o.at(0))*(o.at(1)-a.at(1))}return t<0}function Ot(e,t,n){return(t.at(0)-e.at(0))*(n.at(1)-e.at(1))-(n.at(0)-e.at(0))*(t.at(1)-e.at(1))}function jt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return g.from([e.at(0),e.at(1),t])}function Ct(e,t,n){for(var r=-1,a=t,o=0;o<e.length;o++){var i=ue(U(e[o],n));i<a&&(r=o,a=i)}return r}function St(e,t,n){for(var r=[],a=0;a<e.length;a++){var o=e[a];o.drawableWorld.isInsideXY(t,n)&&r.push({obj:o,index:a})}return r.sort((function(e,t){var n=e.obj,r=t.obj;return n.options.z===r.options.z?r.id-n.id:r.z-n.z})),r}function _t(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),o=n[0],i=n[1],s=a.a.createElement("div",null,a.a.createElement("div",{className:"fullscreen transparent",onClick:function(){return i((function(){return!1}))}}),a.a.createElement("div",{className:"help-window"},a.a.createElement("div",null,a.a.createElement("h3",null,"What you can see:"),a.a.createElement("p",null,"On the left side is a 3D drawing of your scene. On the right is a top down view. That is also where you change and create elements."),a.a.createElement("h3",null,"General controls:"),a.a.createElement("p",null,"You can move around the 3D scene by dragging the mouse on it to change your viewing direction. WASD is used for movement in your viewplane. 'q' and 'e' lets you move up and down. Alternatively, you can use the Camera tool to enter specific values."),a.a.createElement("p",null,"In the edit view, you can drag the screen via clicking and dragging the middle mouse button. If you move your mouse to the borders of the view, it will also move in that direction. Helpful, if you want to create objects bigger than the current viewport. You can zoom with the Viewport settings on the right and also with your mousewheel."),a.a.createElement("h3",null,"Select Tool:"),a.a.createElement("p",null,"Allows you to select objects. Their properties are displayed below the view. If no object is selected, you can also delete them all."),a.a.createElement("p",null,"You can set various properties and delete the object there. If there are multiple overlapping objects where you click, the topmost or newest will be selected first. To select the other objects, keep clicking and it will cycle through them. You can deselect objects by clicking on empty space."),a.a.createElement("p",null,"When an object is selected, a small circle appears at its center. You can move the object around by dragging  that circle."),a.a.createElement("h3",null,"Move Viewport Tool:"),a.a.createElement("p",null,"Allows you to move the view inside of the edit window. Drag on empty space to move around. The current camera position is displayed as a yellow circle."),a.a.createElement("h3",null,"Camera Tool:"),a.a.createElement("p",null,"Allows you to see and change the position and orientation of the camera. You can also reset the values. You can set the field of view."),a.a.createElement("h3",null,"Points Tool"),a.a.createElement("p",null,"Allows you to create objects by placing the outer points on the edit window by clicking. With activated snapping, the points will always lie on the displayed grid. You can see the length of each line displayed in the middle of that line. You can close an object by clicking either on the first or last point. If you click on the first point, a polygon is created. Clicking on the last will create a line strip."),a.a.createElement("h3",null,"Rectangle Tool"),a.a.createElement("p",null,"Allows you to create rectangles. With activated snapping, the points will always lie on the displayed grid. A rectangle is created by pressing the left mouse button and then moving the mouse to the desired location. Letting go of the button will create the rectangle. No rectangle will be created, if any side has a length of zero."),a.a.createElement("h3",null,"Freehand Tool"),a.a.createElement("p",null,"Allows you to freely draw a polygon. The result will be simplified a bit to avoid unnessecarry clutter."),a.a.createElement("h3",null,"Load/Save Tool"),a.a.createElement("p",null,"Here you can load and save your current scene. This will save all objects and their properties as well as your current camera position and orientation")),a.a.createElement("button",{onClick:function(){return i(!1)}},"Close")));return a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){return i(!0)}},"Show Help"),o?s:null)}function xt(e){var t=e.element,n=e.eventName,a=e.handleEvent,o=Object(r.useRef)();Object(r.useEffect)((function(){o.current=a}),[a]),Object(r.useEffect)((function(){if(t){var e=function(e){return o.current(e)};return t.addEventListener(n,e),function(){t.removeEventListener(n,e)}}}),[t,n])}function Mt(e,t,n,r){this._r=void 0!==e?e:1,this._g=void 0!==t?t:1,this._b=void 0!==n?n:1,this._a=void 0!==r?r:1}function Lt(e){var t,n=e.r,r=e.g,a=e.b,o=Math.max(n,r,a),i=Math.min(n,r,a),s=o-i,u=0===o?0:s/o,c=o;switch(o){case i:t=0;break;case n:t=r-a+s*(r<a?6:0),t/=6*s;break;case r:t=a-n+2*s,t/=6*s;break;case a:t=n-r+4*s,t/=6*s}return{h:t,s:u,v:c}}function zt(e){var t,n,r,a,o,i,s,u,c=e.h,l=e.s,f=e.v;switch(i=f*(1-l),s=f*(1-(o=6*c-(a=Math.floor(6*c)))*l),u=f*(1-(1-o)*l),a%6){case 0:t=f,n=u,r=i;break;case 1:t=s,n=f,r=i;break;case 2:t=i,n=f,r=u;break;case 3:t=i,n=s,r=f;break;case 4:t=u,n=i,r=f;break;case 5:t=f,n=i,r=s}return{r:t,g:n,b:r}}function Nt(){var e=Array.prototype.slice.call(arguments);1===e.length&&e[0]instanceof Array&&(e=e[0]),this.dashes=e}Mt.new=function(e,t,n,r){return new Mt(e,t,n,r)},Mt.prototype.copy=function(){return Mt.new(this._r,this._g,this._b,this._a)},Mt.prototype.cp=Mt.prototype.copy,Mt.prototype.toString=function(e){var t="";t+=e?"rgb(":"rgba(";var n=Math.floor(255*Math.max(0,Math.min(1,this._r))),r=Math.floor(255*Math.max(0,Math.min(1,this._g))),a=Math.floor(255*Math.max(0,Math.min(1,this._b))),o=Math.max(0,Math.min(1,this._a));return t+=n+",",t+=r+",",t+=a,e||(t+=","+o),t+=")"},Mt.prototype.toSVG=function(e){var t="";return t+=e+":"+this.toString(!0)+"; ",t+=e+"-opacity:"+this.a()+";"},Mt.prototype.r=function(e){return void 0===e?this._r:(this._r=e,this)},Mt.prototype.g=function(e){return void 0===e?this._g:(this._g=e,this)},Mt.prototype.b=function(e){return void 0===e?this._b:(this._b=e,this)},Mt.prototype.a=function(e){return void 0===e?this._a:(this._a=e,this)},Mt.prototype.toJSON=function(){return{r:this._r,g:this._g,b:this._b,a:this._a}},Mt.prototype.changeValue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Lt({r:this._r,g:this._g,b:this._b}),n=t.h,r=t.s,a=t.v;a*=1+e;var o=zt({h:n,s:r,v:a=Math.min(1,Math.max(0,a))}),i=o.r,s=o.g,u=o.b;return Mt.new(i,s,u,this._a)},Mt.RED=Mt.new(1,0,0,1),Mt.LIME=Mt.new(0,1,0,1),Mt.BLUE=Mt.new(0,0,1,1),Mt.WHITE=Mt.new(1,1,1,1),Mt.BLACK=Mt.new(0,0,0,1),Mt.YELLOW=Mt.new(1,1,0,1),Mt.FUCHSIA=Mt.new(1,0,1,1),Mt.AQUA=Mt.new(0,1,1,1),Mt.GREEN=Mt.new(0,.5,0,1),Mt.PURPLE=Mt.new(.5,0,.5,1),Mt.ORANGE=Mt.new(1,.647,0,1),Mt.SALMON=Mt.new(.98,.5,.447,1),Mt.TEAL=Mt.new(0,.5,.5,1),Mt.GRAY=Mt.new(.5,.5,.5,1),Mt.GREY=Mt.GRAY,Mt.VIOLET=Mt.new(.93,.51,.93,1),Mt.AMBER=Mt.new(1,.749,0,1),Mt.ANDROID_GREEN=Mt.new(.643,.776,.223,1),Mt.BALL_BLUE=Mt.new(.129,.67,.803,1),Mt.BITTERSWEET=Mt.new(.996,.435,.368,1),Mt.BRILLIANT_ROSE=Mt.new(1,.333,.639,1),Mt.CELADON=Mt.new(.674,.882,.686,1),Mt.CEIL=Mt.new(.572,.631,.811,1),Mt.DEFAULT_COLORS=[Mt.RED,Mt.LIME,Mt.BLUE,Mt.WHITE,Mt.BLACK,Mt.YELLOW,Mt.FUCHSIA,Mt.AQUA,Mt.GREEN,Mt.PURPLE,Mt.ORANGE,Mt.SALMON,Mt.TEAL,Mt.GRAY,Mt.VIOLET,Mt.AMBER,Mt.ANDROID_GREEN,Mt.BALL_BLUE,Mt.BITTERSWEET,Mt.BRILLIANT_ROSE,Mt.CELADON,Mt.CEIL],Mt.getIndexColor=function(e){return Mt.DEFAULT_COLORS[e%Mt.DEFAULT_COLORS.length].cp()},Nt.new=function(){return Object(et.a)(Nt,Array.prototype.slice.call(arguments))},Nt.prototype.copy=function(){return Nt.new(this.dashes.concat())},Nt.prototype.cp=Nt.prototype.copy,Nt.prototype.toString=function(){var e=this.dashes;if(0===e.length)return"[]";for(var t="[",n=0;n<e.length-1;n++)t+=e[n]+", ";return t+=e[e.length-1],t+="]"},Nt.prototype.toSVG=function(){var e=this.dashes;if(0===e.length)return"";for(var t='stroke-dasharray="',n=0;n<e.length-1;n++)t+=e[n]+", ";return t+=e[e.length-1],t+='"'},Nt.SOLID=Nt.new(),Nt.DASH_EVEN=Nt.new(5,5),Nt.DASH_EVEN_SPACED=Nt.new(5,10),Nt.DASH_ODD=Nt.new(5,5,1,5);var At=function(){function e(t){Object(f.a)(this,e),this.screen=t}return Object(h.a)(e,[{key:"initFrame",value:function(){this.screen.clear()}},{key:"finishFrame",value:function(){}},{key:"getWidth",value:function(){return this.screen.w()}},{key:"getHeight",value:function(){return this.screen.h()}},{key:"download",value:function(e){var t=document.createElement("a");t.href=this.screen.ctx().canvas.toDataURL(),t.download=e+".png",t.click()}},{key:"drawLineStrip",value:function(e,t){if(t=t||ot.new(),0!==e.length){var n=this.screen.ctx();n.save();var r=t.get("strokeStyle",Mt.BLACK);n.strokeStyle=r.toString();var a=t.get("lineWidth",1);n.lineWidth=a,n.beginPath(),n.moveTo(e[0][0],e[0][1]);for(var o=1;o<e.length;o++){var i=e[o];n.lineTo(i[0],i[1])}n.stroke(),n.restore()}}},{key:"drawArc",value:function(e,t,n,r,a){a=a||ot.new();var o=this.screen.ctx();o.save();var i=a.get("strokeStyle",Mt.BLACK),s=a.get("fillStyle",Mt.WHITE),u=a.get("dashArray",Nt.SOLID);if(0!==i.a()||0!==s.a()){var c=a.get("lineWidth",1);o.beginPath(),o.arc(e[0],e[1],t,n,r),o.strokeStyle=i.toString(),o.fillStyle=s.toString(),o.lineWidth=c.toString(),o.setLineDash(u.dashes),o.stroke(),o.fill(),o.restore()}}},{key:"drawText",value:function(e,t,n){n=n||ot.new();var r=this.screen.ctx(),a=n.get("fillStyle",Mt.WHITE),o=n.get("strokeStyle",Mt.BLACK),i=n.get("font",r.font);r.save();var s=this.screen.flip();s&&this.screen.flip(!1),r.font=i,r.strokeStyle=o.toString(),r.fillStyle=a.toString();var u=this.getHeight(),c=s?u-1-e[1]:e[1];r.fillText(t,e[0],c),r.strokeText(t,e[0],c),s&&this.screen.flip(s),r.restore()}},{key:"drawPoly",value:function(e,t){t=t||ot.new();var n=this.screen.ctx();n.save(),n.lineCap="round";var r=e,a=t.get("fillStyle",Mt.WHITE),o=t.get("strokeStyle",Mt.BLACK),i=t.get("lineWidth",1),s=t.get("dashArray",Nt.SOLID);if(n.fillStyle=a.toString(),a.a()>0){n.beginPath();var u=r[0];n.moveTo(u[0],u[1]);for(var c=1;c<r.length;c++){var l=r[c];n.lineTo(l[0],l[1])}n.closePath(),n.fill(),n.strokeStyle=a.toString(),n.lineWidth=.5,1===a.a()&&n.stroke()}if(o.a()>0){n.lineWidth=i,n.setLineDash(s.dashes),n.strokeStyle=o.toString(),n.beginPath();for(var f=0;f<r.length;f++){var h=r[(f+1)%r.length],v=r[f];n.moveTo(v[0],v[1]),n.lineTo(h[0],h[1])}n.stroke()}n.restore()}}],[{key:"new",value:function(t){return new e(t)}}]),e}(),Dt=function(){function e(t,n,r){Object(f.a)(this,e),this.drawLineStrip=function(e,t){if(0!==e.length){var n="<polyline ";n+='stroke-linecap="round" ',n+='fill="none" ';var r=(t=t||ot.new()).get("strokeStyle",Mt.BLACK),a=t.get("lineWidth",1),o=t.get("dashArray",Nt.SOLID),i=t.get("attributes",{});if(0!==r.a()){for(var s in n+='style="',n+=r.toSVG("stroke"),n+='"',n+=" ",n+='stroke-width="'+a+'px" ',n+=o.toSVG(),n+=" ",i)n+=s+'="',n+=i[s],n+='" ';n+='points="';for(var u=0;u<e.length;u++){var c=e[u];n+=c[0]+","+this.y(c[1])+" "}n+='"',n+="/>",this.svg+=n+"\n"}}},this.w=t,this.h=n,this.flipy=void 0===r||r,this.svg=""}return Object(h.a)(e,[{key:"initFrame",value:function(){var e='<svg version="1.1" baseProfile="full" ';e+='width="'+this.w+'" ',e+='height="'+this.h+'" ',e+='shape-rendering="geometricPrecision" ',e+='xmlns="http://www.w3.org/2000/svg">\n',this.svg=e}},{key:"y",value:function(e){return this.flipy?this.h-e:e}},{key:"finishFrame",value:function(){this.svg+="</svg>"}},{key:"getWidth",value:function(){return this.w}},{key:"getHeight",value:function(){return this.h}},{key:"download",value:function(e){var t=document.createElement("a"),n=new Blob([this.svg],{type:"image/svg+xml"});t.href=window.URL.createObjectURL(n),t.download=e+".svg",t.click()}},{key:"drawText",value:function(e,t,n){var r=(n=n||ot.new()).get("svgOptions",{}),a="<text ",o=n.get("strokeStyle",Mt.BLACK),i=n.get("fillStyle",Mt.BLACK),s=n.get("lineWidth",1);0===o.a()&&0===i.a()||(a+='style="',a+=o.toSVG("stroke"),a+=i.toSVG("fill"),a+='"',a+=" ",r.scalingStroke&&(a+='vector-effect="non-scaling-stroke" '),a+='stroke-width="'+s+'px"',a+=" ",a+=" ",a+='x="'+e[0]+'" ',a+='y="'+this.y(e[1])+'" ',a+=">\n",a+=t,a+="\n</text>",this.svg+=a+"\n")}},{key:"drawArc",value:function(e,t,n,r,a){var o=(a=a||ot.new()).get("attributes",{}),i="<circle ",s=a.get("strokeStyle",Mt.BLACK),u=a.get("fillStyle",Mt.WHITE),c=a.get("dashArray",Nt.SOLID);if(0===s.a()&&0===u.a())return"";var l=a.get("lineWidth",1);for(var f in i+='style="',i+=u.toSVG("fill"),i+=s.toSVG("stroke"),i+='"',i+=" ",i+='stroke-width="'+l+'px"',i+=" ",i+=c.toSVG(),i+=" ",o)i+=f+'="',i+=o[f],i+='" ';i+='r="'+t+'"',i+=" ",i+='cx="'+e[0]+'" ',i+='cy="'+this.y(e[1])+'" ',i+="/>",this.svg+=i+"\n"}},{key:"drawPoly",value:function(e,t){var n=(t=t||ot.new()).get("fillStyle",Mt.WHITE),r=t.get("strokeStyle",Mt.BLACK),a=t.get("dashArray",Nt.SOLID),o=t.get("lineWidth",1),i=t.get("attributes",{});if(0!==n.a()||0!==r.a()){var s="",u="<polygon ",c=e;for(var l in u+='style="',u+=n.toSVG("fill"),u+=" ",u+=r.toSVG("stroke"),u+='"',u+=" ",u+='shape-rendering="crispEdges"',u+=" ",u+=" ",u+='stroke-width="',u+=o,u+='"',u+=" ",u+=a.toSVG(),u+=" ",i)u+=l+'="',u+=i[l],u+='" ';u+='points="';for(var f=0;f<c.length;f++){var h=c[f];u+=h[0]+","+this.y(h[1])+" "}s+=(u+='"/>')+"\n",this.svg+=s}}},{key:"begin_group",value:function(){this.svg+="<g>\n"}},{key:"end_group",value:function(){this.svg+="</g>\n"}},{key:"add_svg",value:function(e){this.svg+=e,this.svg+="\n"}}],[{key:"new",value:function(t,n,r){return new e(t,n,r)}}]),e}();function Tt(e,t){var n=e.pos,r=e.dir,a=e.right,o=e.up;return{pos:B(n,t),dir:r,right:a,up:o}}function It(e,t){return Tt(e,be(e.dir,t))}function Pt(e,t){return Tt(e,be(e.right,t))}function Vt(e,t){return Tt(e,be(e.up,t))}function Wt(e){var t=e.setCam,n=(e.camUp,e.canvas),a=e.speed,o=void 0===a?.1:a,i=Object(r.useState)({lastPos:g.from([0,0]),currentPos:g.from([0,0]),pressed:!1}),s=Object(u.a)(i,2),c=s[0],l=s[1],f=Object(r.useState)({}),h=Object(u.a)(f,2),v=h[0],d=h[1],w=Object(r.useCallback)((function(e){var t=function(e,t){t=p(t,!1);var n=e.target.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;return t&&(a=n.height-1-a),g.from([r,a])}(e);l((function(e){return{lastPos:e.currentPos,currentPos:t,pressed:e.pressed}}))}),[]),m=Object(r.useCallback)((function(e){l((function(e){return{lastPos:e.lastPos,currentPos:e.currentPos,pressed:!0}}))}),[]),y=Object(r.useCallback)((function(){l((function(e){return{lastPos:e.lastPos,currentPos:e.currentPos,pressed:!1}}))}),[]),b=Object(r.useCallback)((function(e){var t=e.key;d((function(e){var n=Object.assign({},e);return n[t]=!0,n}))}),[]),k=Object(r.useCallback)((function(e){var t=e.key;d((function(e){var n=Object.assign({},e);return n[t]=!1,n}))}),[]);xt({element:n,eventName:"mousedown",handleEvent:m}),xt({element:n,eventName:"mouseup",handleEvent:y}),xt({element:n,eventName:"mousemove",handleEvent:w}),xt({element:n,eventName:"keydown",handleEvent:b}),xt({element:n,eventName:"keyup",handleEvent:k}),xt({element:n,eventName:"focusout",handleEvent:function(){d((function(){return[]}))}});var E=Object(r.useCallback)((function(e){var n=e*o;t((function(e){var t=function(e){var t=e.pos,n=e.dir,r=e.up;return{pos:t,dir:n=ce(n),right:ce(Te(n,r)),up:r}}(e),r=!1;return v.w&&(t=It(t,n),r=!0),v.s&&(t=It(t,-n),r=!0),v.d&&(t=Pt(t,n),r=!0),v.a&&(t=Pt(t,-n),r=!0),v.q&&(t=Vt(t,-n),r=!0),v.e&&(t=Vt(t,n),r=!0),r?{pos:t.pos,dir:t.dir,up:t.up}:e}))}),[v,t,o]);Object(r.useEffect)((function(){E(.05);var e=setInterval((function(){E(.05)}),50);return function(){clearInterval(e)}}),[E]),Object(r.useEffect)((function(){if(c.pressed){var e=Ye(c.lastPos,c.currentPos);t((function(t){var n=qe(t.dir),r=n.theta,a=n.phi;a-=.01*e.at(0),(a%=2*Math.PI)<0&&(a+=2*Math.PI),r+=.01*e.at(1);var o=Ge(1);return r=Math.max(o,Math.min(Math.PI-o,r)),{pos:t.pos,dir:He(r,a,1),up:t.up}}))}}),[c,t])}function Bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=Math.floor(e/(t-1)),a=Math.pow(n,r-1),o=1+e%(t-1);return a*o}var Ut=Bt(0);function Gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Bt(e,n,r)*t/2}function Rt(e){var t=e.z,n=void 0===t?0:t,r=e.showBoundVanishingLines,a=void 0!==r&&r,o=e.showBoundGridBottom,i=void 0===o||o,s=e.showBoundGridTop,u=void 0===s||s,c=e.showSideGridFront,l=void 0===c||c,f=e.showSideGridBack,h=void 0!==f&&f,v=e.gridCellLength,d=void 0===v?Ut:v,p=e.gridCellHeight,w=void 0===p?Ut:p,m=e.displayCellLength,y=void 0===m||m,b=e.sideGridStart;return{z:n,showBoundVanishingLines:a,showBoundGridBottom:i,showBoundGridTop:u,showSideGridFront:l,showSideGridBack:h,gridCellLength:d,displayCellLength:y,gridCellHeight:w,sideGridStart:void 0===b?0:b}}var Ft=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.from([0,0,0]),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.from([1,1,1]);Object(f.a)(this,e),this.t=t,this.alpha=n,this.scale=r,this.update()}return Object(h.a)(e,[{key:"toMat",value:function(){return this.m}},{key:"toJSON",value:function(){return{t:De(this.t),alpha:this.alpha,scale:De(this.scale)}}},{key:"update",value:function(){this.m=K(Re(this.t),K(function(e,t){var n=Ue(e,t),r=$(P(n,4,4));return fe(q(r,0,0,3,3),n),r}(Xe,this.alpha),Fe(this.scale)))}},{key:"setAlpha",value:function(e){this.alpha=e,this.update()}},{key:"setTranslation",value:function(e){this.t=e,this.update()}},{key:"setScale",value:function(e){this.scale=e,this.update()}},{key:"copy",value:function(){return e.new(this.t,this.alpha,this.scale)}}],[{key:"new",value:function(t,n,r){return new e(t,n,r)}}]),e}(),Ht=function(){function e(t,n,r,a,o){Object(f.a)(this,e),this.drawable=t,this.styleData=void 0!==n?n:ot.new(),this.setTransform(p(r,Ft.new())),this.options=Rt(void 0!==a?a:{}),this.id=p(o,tt())}return Object(h.a)(e,[{key:"toJSON",value:function(){return{drawobject:{drawable:this.drawable,transform:this.transform,properties:this.options,styleData:this.styleData,id:this.id}}}},{key:"draw",value:function(e,t,n){t=void 0!==t?t:y.id(4,4),this.drawableWorld.draw(e,this.styleData,t,n)}},{key:"setTransform",value:function(e){this.transform=e;var t,n,r=this.drawable.center;this.M=K(Re(r),K(this.transform.toMat(),Re(X(r)))),this.drawableWorld=this.drawable.transform(this.M),this.xyboundsWorld=(t=this.drawable.xybounds,n=this.M,t=We(t=K(n,t=I.new(t,4,t.cols(),1,1))),y.copy(q(t,0,0,3,t.cols())))}},{key:"clone",value:function(){return e.new(this.drawable.clone(),this.styleData.copy(),this.transform.copy(),it(this.options))}}],[{key:"new",value:function(t,n,r,a,o){return new e(t,n,r,a,o)}}]),e}(),qt=function(){function e(t,n,r,a){Object(f.a)(this,e),this.drawable=t,this.styleData=n,this.z=r,this.id=p(a,tt())}return Object(h.a)(e,null,[{key:"new",value:function(t,n,r,a){return new e(t,n,r,a)}}]),e}(),Yt=function(){function e(t){Object(f.a)(this,e),this.points=t;var n=wt(t),r=Object(u.a)(n,2),a=r[0],o=r[1];this.bmin=a,this.bmax=o,this.center=be(B(a,o),.5);var i=y.uninitialized(3,4);fe(J(i,0),a),fe(J(i,1),g.from([o.at(0),a.at(1),a.at(2)])),fe(J(i,2),o),fe(J(i,3),g.from([a.at(0),o.at(1),a.at(2)])),this.xybounds=i}return Object(h.a)(e,[{key:"toJSON",value:function(){return{type:"Polygon",points:De(this.points)}}},{key:"transform",value:function(t){var n=this.points;return n=We(n=K(t,n=I.new(n,4,n.cols(),1,1))),e.new(y.copy(q(n,0,0,3,n.cols())))}},{key:"draw",value:function(e,t){var n=kt(this.points);e.drawPoly(n,t)}},{key:"clip",value:function(t){for(var n=[],r=this.points,a=r.cols(),o=J(r,a-1),i=function(e,t){return t.push.apply(t,Object(s.a)(re(e)))},c=0,l=0;l<a;l++){var f=J(r,l);if(gt(f,t))if(gt(o,t))i(f,n),c++;else{var h=mt(o,f,t);i(Object(u.a)(h,1)[0],n),c++,i(f,n),c++}else if(gt(o,t)){var v=mt(o,f,t);i(Object(u.a)(v,1)[0],n),c++}o=f}return 0===c?null:e.new(y.from(n,3,c))}},{key:"clone",value:function(){return e.new(V(this.points))}},{key:"isInsideXY",value:function(e,t){var n=this.points;if(!pt(e,this.bmin,this.bmax))return!1;if(function(e,t){for(var n=function(e){return y.copy(Oe(J(t,e),0,2))},r=function(e){return e.at(1)},a=0,o=0;o<t.cols();o++){var i=n(o),s=n((o+1)%t.cols());r(i)<=r(e)?r(s)>r(e)&&Ot(i,s,e)>0&&++a:r(s)<=r(e)&&Ot(i,s,e)<0&&--a}return 0!==a}(e,n))return!0;for(var r=n.cols(),a=t*t,o=function(e){return y.copy(Oe(J(n,e),0,2))},i=0;i<r;i++){if(vt(e,o(i),o((i+1)%r))<a)return!0}return!1}}],[{key:"new",value:function(t){return new e(t)}}]),e}(),Jt=function(){function e(t){Object(f.a)(this,e),this.points=t;var n=wt(t),r=Object(u.a)(n,2),a=r[0],o=r[1];this.bmin=a,this.bmax=o,this.center=be(B(a,o),.5);var i=y.uninitialized(3,4);fe(J(i,0),a),fe(J(i,1),g.from([o.at(0),a.at(1),a.at(2)])),fe(J(i,2),o),fe(J(i,3),g.from([a.at(0),o.at(1),a.at(2)])),this.xybounds=i}return Object(h.a)(e,[{key:"toJSON",value:function(){return{type:"LineStrip",points:De(this.points)}}},{key:"transform",value:function(t){var n=this.points;return n=We(n=K(t,n=I.new(n,4,n.cols(),1,1))),e.new(y.copy(q(n,0,0,3,n.cols())))}},{key:"draw",value:function(e,t){var n=kt(this.points);e.drawLineStrip(n,t)}},{key:"clip",value:function(t){for(var n=[],r=this.points,a=r.cols(),o=0,i=function(e){n.push.apply(n,Object(s.a)(re(e))),o++},c=1;c<a;c++){var l=J(r,c-1),f=J(r,c);if(gt(f,t))if(gt(l,t))1===c&&i(l),i(f);else{var h=mt(l,f,t);i(Object(u.a)(h,1)[0]),i(f)}else if(gt(l,t)){1===c&&i(l);var v=mt(l,f,t);i(Object(u.a)(v,1)[0])}}return 0===o?null:e.new(y.from(n,3,o))}},{key:"clone",value:function(){return e.new(V(this.points))}},{key:"isInsideXY",value:function(e,t){var n=g.from([t,t,t]);if(!pt(e,U(this.bmin,n),B(this.bmax,n)))return!1;for(var r=this.points,a=r.cols(),o=t*t,i=0;i<a-1;i++){if(vt(e,g.copy(Oe(J(r,i),0,2)),g.copy(Oe(J(r,i+1),0,2)))<o)return!0}return!1}}],[{key:"new",value:function(t){return new e(t)}}]),e}(),Kt=function(){function e(t,n){Object(f.a)(this,e),this.points=t,this.bmin=t,this.bmax=t,this.center=t,this.radius=p(n,2);var r=y.uninitialized(3,4);fe(J(r,0),t),fe(J(r,1),t),fe(J(r,2),t),fe(J(r,3),t),this.xybounds=r}return Object(h.a)(e,[{key:"toJSON",value:function(){return{type:"Point",points:De(this.points),radius:this.radius}}},{key:"transform",value:function(t){var n=this.points;return n=We(n=K(t,n=I.new(n,4,n.cols(),1,1))),e.new(y.copy(q(n,0,0,3,n.cols())),this.radius)}},{key:"draw",value:function(e,t){var n=this.points;e.drawArc(re(n),this.radius,0,2*Math.PI,t)}},{key:"clip",value:function(t){var n=this.points;return gt(n,t)?e.new(n,this.radius):null}},{key:"clone",value:function(){return e.new(V(this.points),this.radius)}},{key:"isInsideXY",value:function(e,t){return ue(U(e,this.points))<t*t}}],[{key:"new",value:function(t,n){return new e(t,n)}}]),e}(),Xt=function(){function e(t,n){Object(f.a)(this,e),this.points=t,this.bmin=t,this.bmax=t,this.center=t,this.text=n;var r=y.uninitialized(3,4);fe(J(r,0),t),fe(J(r,1),t),fe(J(r,2),t),fe(J(r,3),t),this.xybounds=r}return Object(h.a)(e,[{key:"toJSON",value:function(){return{type:"Text",points:De(this.points),text:this.text}}},{key:"transform",value:function(t){var n=this.points;return n=We(n=K(t,n=I.new(n,4,n.cols(),1,1))),e.new(y.copy(q(n,0,0,3,n.cols())),this.text)}},{key:"draw",value:function(e,t){var n=this.points;e.drawText(re(n),this.text,t)}},{key:"clip",value:function(t){var n=this.points;return gt(n,t)?e.new(n,this.text):null}},{key:"clone",value:function(){return e.new(V(this.points),this.text)}},{key:"isInsideXY",value:function(e,t){return!0}}],[{key:"new",value:function(t,n){return new e(t,n)}}]),e}(),Qt=n(96);function $t(e,t,n){var r,a,o;n=p(n,(r=t.rows(),a=t.cols(),o=p(o=t.type(),d),m.new(o).zeros(r,a)));var i=K(e,Be(t)),s=K(e,Be(n));return ue(U(Oe(We(i),0,3),Oe(We(s),0,3)))}var Zt=n(2),en=n.n(Zt),tn=n(97),nn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"reset",value:function(){this.state=0,this.currentObject=[],this.hoverIndex=-1}},{key:"updateVis",value:function(e){var t=[],n=e.mouse,r=e.viewTransforms,a=n.snappedMousePosWorld,o=e.overlay.setOverlayObjects,i=ot.new({fillStyle:Mt.PURPLE.cp().a(.5)});t.push(Ht.new(Kt.new(jt(a),5),i,Ft.new(),Rt({z:1/0})));var u=this.currentObject,c=[].concat(Object(s.a)(u),[jt(a)]);2===c.length?t.push(Ht.new(Jt.new(y.fromCols(c)),ot.new({strokeStyle:Mt.RED.cp().a(.5)}))):c.length>2&&t.push(Ht.new(Yt.new(y.fromCols(c)),ot.new({strokeStyle:Mt.RED.cp().a(.5),fillStyle:Mt.LIME.cp().a(.5)})));for(var l,f=ot.new({fillStyle:Mt.VIOLET.cp().a(.5)}),h=ot.new({fillStyle:Mt.RED}),v=0;v<u.length;v++){var d=u[v],p=v===this.hoverIndex?h:f;t.push(Ht.new(Kt.new(d,5),p,Ft.new(),Rt({z:1/0})))}if(u.length>0){var w=u[u.length-1],m=Ye(w,jt(a)),b=B(w,be(m,.5)),k=(l=m,g.from([-l.at(1),l.at(0),0]));ce(k,k);var E=$t(r.MCanvas2Viewport,g.from([5,0,0])),O=B(b,be(k,-Math.sqrt(E)));t.push(Ht.new(Xt.new(O,ie(m).toFixed(2)),ot.new(),Ft.new(),Rt({z:1/0})))}o((function(){return t}))}},{key:"render",value:function(e){return null}},{key:"update",value:function(e,t){var n=t.type,r=e.mouse,a=e.context,o=e.viewTransforms,i=r.snappedMousePosWorld,u=a.objects,c=a.setObjects,l=a.viewport,f=e.requestVisUpdate;if(0===this.state)if(5===n){var h=[jt(i,0)];this.state=1,this.currentObject=h,f()}else 2===n&&f();else if(1===this.state)if(5===n){var v=this.currentObject,d=Ct(v,$t(o.MCanvas2Viewport,g.from([5,5,0])),jt(i,0));if(d>=0){var p=Bt(l.zoomLevel);if(0===d&&v.length>2){var w=Et(v)?v.reverse():v,m=Yt.new(y.fromCols(w)),b=Mt.getIndexColor(Math.round(Math.random()*Mt.DEFAULT_COLORS.length)).cp().a(.75),k=Ht.new(m,ot.new({fillStyle:b,strokeStyle:b.changeValue(-.5)}),Ft.new(),Rt({gridCellLength:p,gridCellHeight:p}));this.reset(),c((function(){return[].concat(Object(s.a)(u),[k])})),f()}else if(d===v.length-1){var E=Jt.new(y.fromCols(v)),O=Mt.getIndexColor(Math.round(Math.random()*Mt.DEFAULT_COLORS.length)).cp().a(.75),j=Ht.new(E,ot.new({strokeStyle:O,lineWidth:2}),Ft.new(),Rt({gridCellLength:p,gridCellHeight:p}));this.reset(),c((function(){return[].concat(Object(s.a)(u),[j])})),f()}}else this.currentObject.push(jt(i,0)),f()}else if(2===n){var C=$t(o.MCanvas2Viewport,g.from([5,5,0])),S=Ct(this.currentObject,C,jt(i,0));this.hoverIndex=S,f()}else 4===n&&(this.reset(),f())}}],[{key:"new",value:function(){return new e}}]),e}(),rn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"reset",value:function(){this.state=0,this.currentStart=null}},{key:"updateVis",value:function(e){var t=[],n=e.mouse,r=e.viewTransforms,a=n.snappedMousePosWorld,o=e.overlay.setOverlayObjects,i=ot.new({fillStyle:Mt.PURPLE.cp().a(.5)});if(t.push(Ht.new(Kt.new(jt(a),5),i,Ft.new(),Rt({z:1/0}))),1===this.state){var s=this.currentStart,u=jt(a,0),c=R(s,u),l=F(s,u),f=Ye(c,l),h=B(c,be(Je,f.at(0))),v=B(c,be(Ke,f.at(1))),d=y.fromCols([c,h,l,v]),p=Yt.new(d),w=Ht.new(p,ot.new({strokeStyle:Mt.RED.cp().a(.5),fillStyle:Mt.LIME.cp().a(.5)}));t.push(w);var m=$t(r.MCanvas2Viewport,g.from([5,0,0])),b=Math.sqrt(m),k=B(c,be(Je,.5*f.at(0))),E=B(k,be(Ke,-b));t.push(Ht.new(Xt.new(E,f.at(0).toFixed(2)),ot.new(),Ft.new(),Rt({z:1/0})));var O=B(l,be(Ke,-.5*f.at(1))),j=B(O,be(Je,b));t.push(Ht.new(Xt.new(j,f.at(1).toFixed(2)),ot.new(),Ft.new(),Rt({z:1/0})))}o((function(){return t}))}},{key:"render",value:function(e){return null}},{key:"update",value:function(e,t){var n=t.type,r=e.mouse,a=e.context,o=e.viewTransforms,i=r.snappedMousePosWorld,u=a.objects,c=a.setObjects,l=a.viewport,f=e.requestVisUpdate;if(0===this.state){if(6===n){var h=jt(i,0);this.state=1,this.currentStart=h,f()}}else if(1===this.state)if(7===n){var v=this.currentStart,d=jt(i,0),p=R(v,d),w=F(v,d),m=Ye(p,w),b=$t(o.MCanvas2Viewport,g.from([4,0,0])),k=m.at(0),E=m.at(1);if(k*k<b||E*E<b)this.reset(),f();else{var O=[p,B(p,be(Je,m.at(0))),w,B(p,be(Ke,m.at(1)))],j=Mt.getIndexColor(Math.round(Math.random()*Mt.DEFAULT_COLORS.length)).cp().a(.75),C=Yt.new(y.fromCols(O)),S=Bt(l.zoomLevel),_=Ht.new(C,ot.new({fillStyle:j,strokeStyle:j.changeValue(-.5)}),Ft.new(),Rt({gridCellLength:S,gridCellHeight:S}));this.reset(),c((function(){return[].concat(Object(s.a)(u),[_])}))}this.reset(),f()}else 2===n?f():4===n&&(this.reset(),f())}}],[{key:"new",value:function(){return new e}}]),e}();function an(e){var t=e.object,n=Object(r.useState)(!0),o=Object(u.a)(n,2),i=o[0],s=o[1];if(!t)return a.a.createElement("div",null,"No Object selected");var c=t.styleData,l=c.get("fillStyle",Mt.WHITE),f=c.get("strokeStyle",Mt.WHITE),h=t.transform.alpha,v=t.transform.scale,d=t.options.z,p=function(n,r){e.onChange({object:t,index:e.index,values:{scale:g.from([n,r,1])}})},w=function(n,r){var a={};a[n]=r,e.onChange({object:t,index:e.index,options:a})},m=function(n,r){e.onChange({object:t,index:e.index,options:Object(Qt.a)({},n,r)})},y=a.a.createElement(a.a.Fragment,null,a.a.createElement(ht,{value:t.options.gridCellLength,valueName:"Grid cell length",timeout:250,size:6,handleChange:function(e){var t=Math.max(Ut/4,e);m("gridCellLength",t),i&&m("gridCellHeight",t)}}),a.a.createElement(ht,{value:t.options.gridCellHeight,valueName:"Grid cell height",timeout:250,size:6,handleChange:function(e){var t=Math.max(Ut/4,e);m("gridCellHeight",t),i&&m("gridCellLength",t)}}));return a.a.createElement("div",null,a.a.createElement("span",{className:"title"},"Object properties (",a.a.createElement("button",{onClick:function(){return e.handleDelete(t,e.index)}},"Delete"),")"),a.a.createElement("div",{className:"flex-container"},a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Transform"),a.a.createElement(ut,{angle:h,angleName:"Angle",handleChange:function(n){e.onChange({object:t,index:e.index,values:{alpha:n}})},precision:4}),a.a.createElement(ft,{value:d,valueName:"Height ",size:6,handleChange:function(e){return m("z",Math.max(0,e))}}),a.a.createElement(ft,{value:v.at(0),valueName:"Scale x ",size:6,handleChange:function(e){return p(e,v.at(1))}}),a.a.createElement(ft,{value:v.at(1),valueName:"Scale y ",size:6,handleChange:function(e){return p(v.at(0),e)}})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Grid size"),a.a.createElement(ct,{checked:i,labelText:"Use square cells",handleChange:function(e){return s((function(){return e}))}}),y,a.a.createElement(ht,{value:t.options.sideGridStart,valueName:"Grid cell start",timeout:500,size:6,handleChange:function(e){m("sideGridStart",Math.max(0,Math.min(d,e)))}})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Grid display"),a.a.createElement(ct,{checked:t.options.displayCellLength,handleChange:function(e){return m("displayCellLength",e)},labelText:"Cell length"}),a.a.createElement(ct,{checked:t.options.showBoundGridBottom,handleChange:function(e){return w("showBoundGridBottom",e)},labelText:"Bottom grid"}),a.a.createElement(ct,{checked:t.options.showBoundGridTop,handleChange:function(e){return w("showBoundGridTop",e)},labelText:"Top grid"}),a.a.createElement(ct,{checked:t.options.showSideGridFront,handleChange:function(e){return w("showSideGridFront",e)},labelText:"Front grid"}),a.a.createElement(ct,{checked:t.options.showSideGridBack,handleChange:function(e){return w("showSideGridBack",e)},labelText:"Rear grid"}),a.a.createElement(ct,{checked:t.options.showBoundVanishingLines,handleChange:function(n){return r=n,void e.onChange({object:t,index:e.index,options:{showBoundVanishingLines:r}});var r},labelText:"Vanishing lines"})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Color"),a.a.createElement("div",null,"Fill color:",a.a.createElement(on,{color:l,handleChange:function(n){var r=n.rgb,a=Mt.new(r.r/255,r.g/255,r.b/255,r.a),o=c.copy();o.set("fillStyle",a),e.onChange({object:t,index:e.index,values:{styleData:o}})}})),a.a.createElement("div",null,"Stroke color:",a.a.createElement(on,{color:f,handleChange:function(n){var r=n.rgb,a=Mt.new(r.r/255,r.g/255,r.b/255,r.a),o=c.copy();o.set("strokeStyle",a),e.onChange({object:t,index:e.index,values:{styleData:o}})}})))))}function on(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),o=n[0],i=n[1],s=e.color,c=e.handleChange,l=en()({default:{color:{width:"36px",height:"14px",borderRadius:"2px",background:s.toString()},swatch:{padding:"5px",background:"#fff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"absolute",zIndex:"2"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px",transform:"translate(-100%, 0%)"}}});return a.a.createElement("div",null,a.a.createElement("div",{style:l.swatch,onClick:function(){i(!o)}},a.a.createElement("div",{style:l.color})),o?a.a.createElement("div",{className:"color-popover"},a.a.createElement("div",{className:"color-cover",onClick:function(){i(!1)}}),a.a.createElement("div",{className:"color-container"},a.a.createElement(tn.SketchPicker,{color:{r:Math.round(255*s.r()),g:Math.round(255*s.g()),b:Math.round(255*s.b()),a:s.a()},onChange:c}))):null)}var sn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"reset",value:function(){this.state=4,this.currentSelectIndex=-1,this.hoverIndex=-1,this.moveDownMouseWorld=g.from([0,0])}},{key:"render",value:function(e){var t=this,n=e.context,r=n.objects,o=n.setObjects,i=n.viewport,u=this.currentSelectIndex,c=e.requestVisUpdate,l=a.a.createElement("div",null,a.a.createElement("span",{className:"title"},"No object selected"),a.a.createElement("button",{onClick:function(){t.reset(),n.setObjects((function(){return[]}))}},"Clear all"));return a.a.createElement("div",null,u>=0?a.a.createElement(an,{object:u>=0?r[u]:null,index:u,onChange:function(e){var t=e.index,n=e.object,a=e.options,i=e.values;if(void 0!==a){var u=it(n.options);Object.assign(u,e.options),n.options=u}if(i){if(void 0!==i.alpha){var l=n.transform.copy();l.setAlpha(i.alpha),n.setTransform(l)}if(void 0!==i.scale){var f=n.transform.copy();f.setScale(i.scale),n.setTransform(f)}void 0!==i.styleData&&(n.styleData=i.styleData)}o((function(){var e=Object(s.a)(r);return e[t]=n,e})),c()},handleDelete:function(e,n){var a=Object(s.a)(r);a.splice(n,1),o((function(){return a})),t.reset(),c()},viewport:i}):l)}},{key:"updateVis",value:function(e){var t=e.overlay.setOverlayObjects,n=e.mouse,r=e.context,a=e.viewTransforms,o=n.mousePosWorld,i=r.objects,s=$t(a.MCanvas2Viewport,g.from([6,6,0])),u=[];if(this.currentSelectIndex>=0){var c=i[this.currentSelectIndex],l=c.drawableWorld,f=V(Oe(K(c.M,Be(c.drawable.center,1)),0,3)),h=V(Oe(f,0,2)),v=Kt.new(f,6),d=ot.new();ue(U(h,o))<s&&d.set("fillStyle",Mt.RED);var p=ot.new({strokeStyle:Mt.GREEN.cp().a(1),fillStyle:Mt.WHITE.cp().a(.5),lineWidth:4*c.styleData.get("lineWidth",1)});u.push(Ht.new(l,p,Ft.new(),Rt({z:c.options.z}),c.id-.5)),u.push(Ht.new(v,d,Ft.new(),Rt({z:1/0})))}if(this.hoverIndex>=0){var w=i[this.hoverIndex],m=w.drawableWorld,y=ot.new({strokeStyle:Mt.RED.cp().a(1),fillStyle:Mt.WHITE.cp().a(.5),lineWidth:2*w.styleData.get("lineWidth",1)});u.push(Ht.new(m,y,Ft.new(),Rt({z:w.options.z}),w.id-.85))}t((function(){return u}))}},{key:"update",value:function(e,t){var n=this,r=t.type,a=e.mouse,o=e.context,i=e.viewTransforms,u=a.mousePosWorld,c=o.objects,l=o.setObjects,f=e.requestVisUpdate,h=$t(i.MCanvas2Viewport,g.from([4,4,0])),v=Math.sqrt(h);if(4===this.state){var d=St(c,u,v);if(0!==d.length){var p=d[0].index;5===r?(this.currentSelectIndex=p,this.state=5,f()):2===r&&(this.hoverIndex=p,f())}else this.hoverIndex=-1,f()}else if(5===this.state){var w=St(c,u,v);if(5===r){if(0===w.length)return this.reset(),void f();for(var m=-1,y=0;y<w.length;y++)if(w[y].index===this.currentSelectIndex){m=y;break}var b=m>=0?w[(m+1)%w.length].index:w[0].index;this.currentSelectIndex=b,f()}else if(6===r){ue(U(Oe(c[this.currentSelectIndex].drawableWorld.center,0,2),u))<h&&(this.moveDownMouseWorld=u,this.state=6,f())}else 2===r&&(0!==w.length?(this.hoverIndex=w[0].index,f()):(this.hoverIndex=-1,f()))}else if(6===this.state)if(2===r){var k=c[this.currentSelectIndex],E=k.transform,O=E.t,j=Ye(this.moveDownMouseWorld,u);this.moveDownMouseWorld=u;var C=g.from([j.at(0),j.at(1),0]);E.setTranslation(B(O,C)),k.setTransform(E),l((function(){var e=Object(s.a)(c);return e[n.currentSelectIndex]=k,e})),f()}else 7===r&&(this.state=7,this.moveDownMouseWorld=g.from([0,0]),f());else 7===this.state&&(this.state=5,f())}}],[{key:"new",value:function(){return new e}}]),e}(),un=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"render",value:function(e){var t=e.context,n=e.requestVisUpdate,r=t.objects,o=t.setViewport;return a.a.createElement("button",{onClick:function(){if(n(),0!==r.length){for(var e=g.from([-1/0,-1/0,-1/0]),t=g.from([1/0,1/0,1/0]),a=0;a<r.length;a++){var i=r[a].drawableWorld;F(e,i.bmax,e),R(t,i.bmin,t)}var s=be(B(t,e),.5);o((function(e){var t=Object.assign({},e);return t.center=s,t}))}else o((function(e){var t=Object.assign({},e);return t.center=g.from([0,0,0]),t}))}},"Center view")}},{key:"reset",value:function(){this.state=8,this.lastMousePos=g.from([0,0])}},{key:"updateVis",value:function(e){var t=[],n=e.overlay.setOverlayObjects,r=e.context,a=r.cam,o=r.viewport,i=U(o.center,o.halfSize),s=B(o.center,o.halfSize),u=a.pos,c=R(s,u);F(c,i,c);var l=c.at(0)!==u.at(0)||c.at(1)!==u.at(1),f=ot.new({fillStyle:Mt.YELLOW.cp().a(.25),strokeStyle:Mt.BLACK});l&&f.set("fillStyle",Mt.RED.cp().a(.25));var h=Kt.new(c,10);t.push(Ht.new(h,f,Ft.new(),Rt({z:1/0}))),n((function(){return t}))}},{key:"update",value:function(e,t){var n=this,r=e.mouse,a=e.context,o=e.viewTransforms,i=e.requestVisUpdate,s=t.type;if(8===this.state)6===s&&(this.lastMousePos=r.mousePosCanvas,this.state=9,i());else if(9===this.state)if(2===s){var u=this.lastMousePos;a.setViewport((function(e){var t=e.center,a=Ye(r.mousePosCanvas,u);return n.lastMousePos=r.mousePosCanvas,{center:B(t,Oe(K(o.MCanvas2Viewport,Be(jt(a,0),0)),0,3)),halfSize:e.halfSize,zoomLevel:e.zoomLevel}})),i()}else 7===s&&(this.state=8,i())}}],[{key:"new",value:function(){return new e}}]),e}(),cn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"render",value:function(e){var t=e.context,n=t.cam,r=t.setCam,o=t.perspective,i=t.setPerspective,s=n.pos,u=n.dir,c=o.fov,l=s.at(2),f=qe(u),h=f.r,v=f.theta,d=f.phi,p=function(e,t){r((function(n){return{pos:n.pos,dir:He(e,t,h),up:n.up}}))},w=function(e,t,n){r((function(r){return{pos:g.from([e,t,n]),dir:r.dir,up:r.up}}))};return a.a.createElement("div",null,a.a.createElement("span",{className:"title"},"Camera properties ( ",a.a.createElement("button",{onClick:function(){r((function(){return{pos:g.from([-.4,-1.5,1]),dir:g.from([.4,1.5,-1]),up:Xe}})),i((function(e){return{fov:Ge(90),aspect:e.aspect}}))}},"Reset"),")"),a.a.createElement("div",{className:"flex-container"},a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Camera position"),a.a.createElement(ft,{value:s.at(0),valueName:"X",handleChange:function(e){return w(e,s.at(1),s.at(2))}}),a.a.createElement(ft,{value:s.at(1),valueName:"Y",handleChange:function(e){return w(s.at(0),e,s.at(2))}}),a.a.createElement(ft,{value:l,valueName:"Height",handleChange:function(e){return w(s.at(0),s.at(1),e)}})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"subtitle"},"Camera Orientation"),a.a.createElement(ut,{angle:d,angleName:"Longitude",handleChange:function(e){return p(v,e)}}),a.a.createElement(ut,{angle:v,angleName:"Latitude",handleChange:function(e){return p(e,d)},angleMin:1,angleMax:179,clockwise:!1}),a.a.createElement(ut,{angle:c,angleName:"Field of vision",handleChange:function(e){return i((function(t){return{fov:e,aspect:t.aspect}}))},angleMin:1,angleMax:179,clockwise:!1}))))}},{key:"reset",value:function(){}},{key:"updateVis",value:function(e){}},{key:"update",value:function(e,t){}}],[{key:"new",value:function(){return new e}}]),e}();function ln(e){return y.from(e.data,e.rows,e.cols)}function fn(e,t){if("drawable"===e){var n=t.type,r=t.points;if("Polygon"===n)return Yt.new(ln(r));if("LineStrip"===n)return Jt.new(ln(r));if("Point"===n)return Kt.new(ln(r),t.radius);if("Text"===n)return Xt.new(ln(r),t.text)}else{if("transform"===e){var a=t.t,o=t.alpha,i=t.scale;return Ft.new(ln(a),o,ln(i))}if("drawobject"===e){var s=t.drawable,u=t.transform,c=t.properties,l=t.styleData,f=t.id;return Ht.new(s,ot.new(l),u,c,f)}if("fillStyle"===e){var h=t.r,v=t.g,d=t.b,p=t.a;return Mt.new(h,v,d,p)}if("strokeStyle"===e){var w=t.r,m=t.g,y=t.b,b=t.a;return Mt.new(w,m,y,b)}if("objects"===e)return t.map((function(e){return e.drawobject}));if("cam"===e){var g=t.pos,k=t.dir,E=t.up;return{pos:ln(g),dir:ln(k),up:ln(E)}}}return t}function hn(e){var t=e.objects,n=e.setObjects,o=e.cam,i=e.setCam,c=Object(r.useState)(!1),l=Object(u.a)(c,2),f=l[0],h=l[1],v=Object(r.useRef)(null),d=a.a.createElement("div",null,a.a.createElement("div",{className:"fullscreen transparent",onClick:function(){return h((function(){return!1}))}}),a.a.createElement("div",{className:"load-window"},a.a.createElement("span",{className:"title"},"Type in your json object here:"),a.a.createElement("div",null,a.a.createElement("textarea",{ref:v,rows:10,cols:80})),a.a.createElement("button",{onClick:function(){var e=v.current.value,t=JSON.parse(e,fn);n((function(e){return[].concat(Object(s.a)(e),Object(s.a)(t.objects))})),i((function(){return t.cam})),h(!1)}},"Load"),a.a.createElement("button",{onClick:function(){return h(!1)}},"Close")));return a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){var e=document.createElement("a"),n=new Blob([JSON.stringify({objects:t,cam:{pos:De(o.pos),dir:De(o.dir),up:De(o.up)}})],{type:"application/json"});e.href=URL.createObjectURL(n);var r=new Date,a=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate();e.download=a+"_scene.json",e.click()}},"Save to JSON"),a.a.createElement("button",{onClick:function(){return h(!0)}},"Load from JSON"),f?d:null)}var vn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"reset",value:function(){}},{key:"updateVis",value:function(e){}},{key:"render",value:function(e){var t=e.context,n=t.objects,r=t.setObjects,o=t.cam,i=t.setCam;return a.a.createElement(hn,{objects:n,setObjects:r,cam:o,setCam:i})}},{key:"update",value:function(e,t){}}],[{key:"new",value:function(){return new e}}]),e}(),dn=function(){function e(){Object(f.a)(this,e),this.reset()}return Object(h.a)(e,[{key:"reset",value:function(){this.state=0,this.currentObject=[]}},{key:"updateVis",value:function(e){var t=[],n=e.mouse.mousePosWorld,r=e.overlay.setOverlayObjects,a=ot.new({fillStyle:Mt.PURPLE.cp().a(.5)});t.push(Ht.new(Kt.new(jt(n),5),a,Ft.new(),Rt({z:1/0})));var o=this.currentObject,i=[].concat(Object(s.a)(o),[jt(n)]);2===i.length?t.push(Ht.new(Jt.new(y.fromCols(i)),ot.new({strokeStyle:Mt.RED.cp().a(.5)}))):i.length>2&&t.push(Ht.new(Yt.new(y.fromCols(i)),ot.new({strokeStyle:Mt.RED.cp().a(.5),fillStyle:Mt.LIME.cp().a(.5)}))),r((function(){return t}))}},{key:"render",value:function(e){return null}},{key:"update",value:function(e,t){var n=t.type,r=e.mouse,a=e.context,o=e.viewTransforms,i=r.mousePosWorld,c=a.objects,l=a.setObjects,f=a.viewport,h=e.requestVisUpdate;if(0===this.state)if(6===n){var v=[jt(i,0)];this.state=1,this.currentObject=v,h()}else 2===n&&h();else if(1===this.state)if(7===n){var d=this.currentObject;if(d.length>2){var p=$t(o.MCanvas2Viewport,g.from([1,1,0])),w=Math.sqrt(p),m=Et(d)?d.reverse():d;m=function e(t,n){var r=t.length-1,a=t[0],o=t[r],i=o.at(0)-a.at(0),c=o.at(1)-a.at(1),l=t.slice(1,r).map((function(e){return Math.abs(c*e.at(0)-i*e.at(1)+o.at(0)*a.at(1)-o.at(1)*a.at(0))})).reduce((function(e,t,n){var r=Math.max(e[0],t);return[r,r===e[0]?e[1]:n+1]}),[-1,0]),f=Object(u.a)(l,2),h=f[0],v=f[1];return h>n?[].concat(Object(s.a)(e(t.slice(0,v+1),n)),Object(s.a)(e(t.slice(v),n).slice(1))):[t[0],t[r]]}(m,w).map((function(e){return jt(e)}));var b=Yt.new(y.fromCols(m)),k=Mt.getIndexColor(Math.round(Math.random()*Mt.DEFAULT_COLORS.length)).cp().a(.75),E=Bt(f.zoomLevel),O=Ht.new(b,ot.new({fillStyle:k,strokeStyle:k.changeValue(-.5)}),Ft.new(),Rt({gridCellLength:E,gridCellHeight:E}));this.reset(),l((function(){return[].concat(Object(s.a)(c),[O])}))}this.reset(),h()}else if(2===n){var j=this.currentObject,C=$t(o.MCanvas2Viewport,g.from([1,1,0]));if(ue(U(Oe(j[j.length-1],0,2),i))<C)return void h();this.currentObject.push(jt(i,0)),h()}else 4===n&&(this.reset(),h())}}],[{key:"new",value:function(){return new e}}]),e}();function pn(e,t){var n=e.center,r=e.halfSize,a=r.at(0),o=r.at(1),i=a/o,s=Gt(t);return a>o?{center:n,halfSize:g.from([s,s/i,0]),zoomLevel:t}:{center:n,halfSize:g.from([s*i,s,0]),zoomLevel:t}}function wn(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],a=t[1];return[n,Object(r.useCallback)((function(e){a(e)}),[])]}function mn(e,t){t=p(t,!0);var n=e.target.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;return t&&(a=n.height-1-a),g.from([r,a])}function yn(e,t){var n=g.from([e.at(0),e.at(1),0,1]);return g.copy(Oe(K(t,n),0,2))}function bn(e){var t=e.onToolChange,n=e.tool;return a.a.createElement(a.a.Fragment,null,a.a.createElement("span",{className:"title"},"Tools"),a.a.createElement("div",{className:"toolselect-buttons"},a.a.createElement("button",{disabled:n===Cn,onClick:function(){t(Cn)}},"Rectangle"),a.a.createElement("button",{disabled:n===gn,onClick:function(){t(gn)}},"Points"),a.a.createElement("button",{disabled:n===On,onClick:function(){t(On)}},"Freehand"),a.a.createElement("button",{disabled:n===kn,onClick:function(){t(kn)}},"Select"),a.a.createElement("button",{disabled:n===En,onClick:function(){t(En)}},"Move viewport"),a.a.createElement("button",{disabled:n===Sn,onClick:function(){t(Sn)}},"Camera"),a.a.createElement("button",{disabled:n===jn,onClick:function(){t(jn)}},"Load/Save")))}var gn=0,kn=1,En=2,On=3,jn=4,Cn=5,Sn=6;function _n(e){var t=wn(),n=Object(u.a)(t,2),o=n[0],i=n[1],s=Object(r.useContext)(Un),c=Object(r.useState)(Cn),l=Object(u.a)(c,2),f=l[0],h=l[1],v=Object(r.useState)({mousePosCanvas:g.from([1/0,1/0]),mousePosWorld:g.from([1/0,1/0]),snappedMousePosCanvas:g.from([1/0,1/0]),snappedMousePosWorld:g.from([1/0,1/0]),inside:!1}),d=Object(u.a)(v,2),p=d[0],w=d[1],m=Object(r.useState)([]),b=Object(u.a)(m,2),k=b[0],E=b[1],O=Object(r.useState)(nn.new()),j=Object(u.a)(O,2),C=j[0],S=j[1],_=Object(r.useState)(!0),x=Object(u.a)(_,2),M=x[0],L=x[1],z=Object(r.useState)({MNormalized2Canvas:y.id(4,4),MViewport2Normalized:y.id(4,4),MViewPort2Canvas:y.id(4,4),MCanvas2Viewport:y.id(4,4),canvasSize:{width:0,height:0}}),N=Object(u.a)(z,2),A=N[0],D=N[1],T=Object(r.useState)(0),I=Object(u.a)(T,2),P=I[0],V=I[1],W=function(){return V((function(e){return e+1}))},G=Object(r.useState)({mouse:p,overlay:{overlayObjects:k,setOverlayObjects:E},viewTransforms:A,context:s,requestVisUpdate:W}),R=Object(u.a)(G,2),F=R[0],H=R[1];!function(e){var t=e.canvas,n=e.context,a=e.viewTransforms,o=Object(r.useState)(0),i=Object(u.a)(o,2),s=i[0],c=i[1],l=Object(r.useState)(g.from([0,0])),f=Object(u.a)(l,2),h=f[0],v=f[1],d=Object(r.useCallback)((function(e){if(1===s){var t=mn(e);v((function(){return t})),n.setViewport((function(e){var n=e.center,r=Ye(t,h);return{center:B(n,Oe(K(a.MCanvas2Viewport,Be(jt(r,0),0)),0,3)),halfSize:e.halfSize,zoomLevel:e.zoomLevel}}))}}),[n,s,h,a]),p=Object(r.useCallback)((function(e){1===e.button&&(v((function(){return mn(e)})),c((function(){return 1})),e.preventDefault(),e.stopPropagation())}),[]),w=Object(r.useCallback)((function(e){1===e.button&&(c((function(){return 0})),e.preventDefault(),e.stopPropagation())}),[]);xt({element:t,eventName:"mousedown",handleEvent:p}),xt({element:t,eventName:"mouseup",handleEvent:w}),xt({element:t,eventName:"mousemove",handleEvent:d}),xt({element:t,eventName:"mouseleave",handleEvent:function(){c((function(){return 0}))}}),Object(r.useEffect)((function(){c((function(){return 0}))}),[t])}({canvas:o,context:s,viewTransforms:A}),function(e){e.enabled;var t=e.borderSize,n=void 0===t?10:t,a=e.speed,o=void 0===a?1:a,i=e.mouse,s=e.viewTransforms,c=e.setViewport,l=Object(r.useState)({dx:0,dy:0,moving:!1}),f=Object(u.a)(l,2),h=f[0],v=f[1],d=s.canvasSize,p=i.mousePosCanvas,w=h.dx,m=h.dy,y=h.moving;Object(r.useEffect)((function(){if(y){var e=setInterval((function(){c((function(e){var t=e.center,n=Bt(e.zoomLevel),r=100*o/1e3*n;return{center:B(t,g.from([r*w,r*m,0])),halfSize:e.halfSize,zoomLevel:e.zoomLevel}}))}),100);return function(){clearInterval(e)}}}),[y,w,m,c,s,o]);var b=p.at(0),k=p.at(1);Object(r.useEffect)((function(){var e=0,t=0;i.inside&&(b<n?e-=1:b>d.width-n&&(e+=1),k<n?t-=1:k>d.height-n&&(t+=1));var r=0!==e||0!==t;v((function(){return{moving:r,dx:e,dy:t}}))}),[b,k,d.width,d.height,n,i.inside])}({viewTransforms:A,setViewport:s.setViewport,mouse:p,speed:10}),Object(r.useEffect)((function(){H((function(){return{mouse:p,overlay:{setOverlayObjects:E},viewTransforms:A,context:s,requestVisUpdate:W}}))}),[p,s,A]);Object(r.useEffect)((function(){!function(e){E([]),e===gn?S((function(){return nn.new()})):e===kn?S((function(){return sn.new()})):e===En?S(un.new()):e===On?S(dn.new()):e===jn?S(vn.new()):e===Cn?S(rn.new()):e===Sn&&S(cn.new())}(f)}),[f]);var q=s.viewport,Y=s.setViewport;Object(r.useEffect)((function(){}),[]),Object(r.useEffect)((function(){if(o){var e=q.center,t=q.halfSize,n={},r=o.width/2,a=o.height/2;n.MNormalized2Canvas=K(Re(g.from([r,a,0])),Fe(g.from([r,a,1])));var i=0!==t.at(0)?1/t.at(0):0,s=0!==t.at(1)?1/t.at(1):0;n.MViewport2Normalized=K(Fe(g.from([i,s,1])),Re(X(e))),n.MViewPort2Canvas=K(n.MNormalized2Canvas,n.MViewport2Normalized),n.MCanvas2Viewport=we(n.MViewPort2Canvas),n.canvasSize={width:o.width,height:o.height},D(n)}}),[o,q]);var Q=Object(r.useCallback)((function(e,t){var n=e/t;Y((function(r){var a=r.center,o=r.halfSize,i=o.at(0),s=o.at(1),u=Math.max(i,s);return e>t?{center:a,halfSize:g.from([u,u/n,0]),zoomLevel:r.zoomLevel}:{center:a,halfSize:g.from([u*n,u,0]),zoomLevel:r.zoomLevel}}))}),[Y]),$=e.objects;Object(r.useEffect)((function(){if(o){var e=ot.new({strokeStyle:Mt.new(.2,.2,.2,.6)}),t=q.center,n=q.halfSize,r=At.new(at.new().canvas(o));r.initFrame();var a=A.MViewPort2Canvas,i=[],s=ot.new({strokeStyle:Mt.AQUA.cp().a(.45)}),u=[],c=U(t,n),l=c.at(0),f=c.at(1),h=Bt(q.zoomLevel);l=h*Math.floor(l/h),f=h*Math.floor(f/h),c.set(l,0),c.set(f,0);for(var v=2*n.at(0),d=2*n.at(1),p=Math.ceil(v/h)+1,w=Math.ceil(d/h)+1,m=be(Je,h*p),b=be(Ke,h*w),E=0;E<=p;E++){var O=g.from([l+E*h,f,0]),j=B(O,b);u.push(Jt.new(y.fromCols([O,j])))}for(var C=0;C<=w;C++){var S=g.from([l,f+C*h,0]),_=B(S,m);u.push(Jt.new(y.fromCols([S,_])))}for(var x=0;x<u.length;x++){var M=u[x];Dn(i,M,s,[],a,-1)}if($){for(var L=0;L<$.length;L++){var z=$[L].xyboundsWorld,N=ot.new({fillStyle:Mt.new(0,0,0,0),strokeStyle:Mt.RED.cp().a(.5)});Dn(i,Yt.new(z),N,[],a,$[L].options.z)}for(var D=0;D<$.length;D++){var T=$[D],I=T.xyboundsWorld;if(T.options.showBoundGridBottom||T.options.showBoundGridTop){var P=Nn({points:y.fromCols([J(I,0),J(I,1)]),upDir:ce(Te(Xe,Ye(J(I,0),J(I,1)))),upHeight:ie(U(J(I,3),J(I,0))),cellLength:$[D].options.gridCellLength,cullOptions:xn});zn({queue:i,drawables:P,styleData:e,M:a})}}for(var V=0;V<$.length;V++){var W=$[V];Dn(i,W.drawableWorld,W.styleData,[],a,W.options.z,W.id)}}k.forEach((function(e){Dn(i,e.drawableWorld,e.styleData,[],a,1/0,e.options.z,e.id)})),i.sort((function(e,t){return e.z===t.z?e.id-t.id:e.z-t.z}));for(var G=0;G<i.length;G++){var R=i[G];R.drawable.draw(r,R.styleData)}r.finishFrame()}}),[$,k,A,q,o]);var Z=function(e){C.update(F,e)};Object(r.useEffect)((function(){C.updateVis(F)}),[C,F,P]);var ee=function(e){if(M){var t=Bt(q.zoomLevel),n=e.at(0),r=e.at(1);return n=t*Math.floor(n/t),r=t*Math.floor(r/t),g.from([n,r])}return e};return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"edit-container"},a.a.createElement("div",{className:"edit-entry"},a.a.createElement("canvas",{ref:i,width:e.width,height:e.height,onClick:function(e){0===e.button&&Z({type:5}),e.stopPropagation(),e.preventDefault()},onMouseMove:function(e){var t=mn(e),n=yn(t,A.MCanvas2Viewport),r=ee(n),a={mousePosCanvas:t,snappedMousePosCanvas:yn(r,A.MViewPort2Canvas),mousePosWorld:n,snappedMousePosWorld:r,inside:!0};w((function(){return a})),Z({type:2,mouse:a})},onMouseLeave:function(e){w((function(e){var t=Object.assign({},e);return t.inside=!1,t}))},onMouseEnter:function(e){var t=mn(e),n=yn(t,A.MCanvas2Viewport),r=ee(n),a={mousePosCanvas:t,snappedMousePosCanvas:yn(r,A.MViewPort2Canvas),mousePosWorld:n,snappedMousePosWorld:r,inside:!0};w((function(){return a}))},onMouseDown:function(e){var t;switch(e.button){case 0:t=6;break;case 2:t=3;break;default:return}Z({type:t}),e.stopPropagation(),e.preventDefault()},onMouseUp:function(e){var t;switch(e.button){case 0:t=7;break;case 2:t=4;break;default:return}Z({type:t}),e.stopPropagation(),e.preventDefault()},onWheel:function(e){var t;t=e.deltaY>=0?1:-1,Y((function(e){return pn(e,Math.min(Math.max(0,e.zoomLevel+t),50))})),e.preventDefault()}},"Canvas not supported")),a.a.createElement("div",{className:"edit-sidebar"},a.a.createElement("div",{className:"edit-sidebar-entry"},a.a.createElement("span",{className:"title"},"Options"),a.a.createElement(_t,null),a.a.createElement(Bn,{canvas:o,buttonName:"Resize edit canvas",handleSizeChange:function(e,t){Q(e,t)}}),a.a.createElement(ct,{checked:M,labelText:"Snap cursor to grid",handleChange:L})),a.a.createElement("div",{className:"edit-sidebar-entry"},a.a.createElement(bn,{tool:f,onToolChange:function(e){h(e)}})),a.a.createElement("div",{className:"edit-sidebar-entry"},a.a.createElement("span",{className:"title"},"Viewport"),a.a.createElement("div",null,a.a.createElement("div",null,"Grid cell length: ",nt(Bt(q.zoomLevel),4)),a.a.createElement("div",null,a.a.createElement(lt,{valueName:"Zoom level",min:0,max:50,step:1,precision:0,value:q.zoomLevel,handleChange:function(e){return Y((function(t){return pn(t,e)}))}})))))),a.a.createElement("div",{className:"edit-container"},C.render(F)))}var xn=0;function Mn(e){return e.showSideGridFront&&e.showSideGridBack?xn:e.showSideGridFront?1:e.showSideGridBack?2:3}function Ln(e,t,n,r){if(!n)return!1;if(r===xn)return!1;if(3===r)return!0;var a=Ee(t,Ye(n,e));return 1===r?a>0:a<0}function zn(e){var t=e.queue,n=e.drawables,r=e.styleData,a=void 0===r?ot.new():r,o=e.clipplanes,i=void 0===o?[]:o,s=e.M;n.forEach((function(e){return Dn(t,e,a,i,s)}))}function Nn(e){var t=e.points,n=e.upDir,r=void 0===n?Xe:n,a=e.upHeight,o=e.cellLength,i=void 0===o?.25:o,u=e.cellHeight,c=void 0===u?i:u,l=e.camPos,f=e.cullOptions,h=void 0===f?xn:f;if(0===a)return[];if(3===h)return[];for(var v=t.cols(),d=[],p=0;p<a;)d.push(p),p+=c;d.push(a);for(var w=be(r,a),m=[],y=2===v?v-1:v,b=0;b<y;b++){for(var g=J(t,b),k=J(t,(b+1)%v),E=B(g,w),O=ie(U(g,k)),j=[],C=0;C<O;)j.push(C),C+=i;j.push(O);var S=An(g,k,E,j,d,l,h);m.push.apply(m,Object(s.a)(S))}return m}function An(e,t,n,r,a,o,i){var s=Ye(e,t),u=Ye(e,n),c=ie(s),l=ie(u);if(c<1e-7||l<1e-7)return[];var f=[];if(!Ln(e,Te(s,u),o,i)){for(var h=0;h<r.length;h++){var v=B(e,be(s,r[h]/c)),d=B(v,u);f.push(Jt.new(y.fromCols([v,d])))}for(var p=0;p<a.length;p++){var w=B(e,be(u,a[p]/l)),m=B(w,s);f.push(Jt.new(y.fromCols([w,m])))}}return f}function Dn(e,t,n,r,a,o,i){if(t=function(e,t){if(t)for(var n=0;n<t.length;n++){var r=t[n];if(!(e=e.clip(r)))return null}return e}(t,r)){a&&(t=t.transform(a));var s=qt.new(t,n,p(o,t.center.at(2)),i);e.push(s)}}function Tn(e,t,n,r,a,o,i){var s=e.xyboundsWorld,u=function(e){return J(s,e)},c=e.options.z;e.options.showBoundGridBottom&&zn({queue:t,drawables:Nn({points:y.fromCols([u(0),u(1)]),upDir:ce(Te(Xe,Ye(u(0),u(1)))),upHeight:ie(U(u(3),u(0))),cellLength:e.options.gridCellLength,camPos:o,cullOptions:xn}),styleData:i,clipplanes:r,M:a});if(c&&c>0){var l=y.copy(s);G(Y(l,2),c);var f=function(e){return J(l,e)};if(e.options.showBoundGridTop)zn({queue:t,drawables:Nn({points:y.fromCols([f(0),f(1)]),upDir:ce(Te(Xe,Ye(f(0),f(1)))),upHeight:ie(U(f(3),f(0))),cellLength:e.options.gridCellLength,camPos:o,cullOptions:xn}),styleData:i,clipplanes:r,M:a})}}function In(e,t,n,r,a,o,i,s){var c=Ye(t,n);if(!gt(t,r)){var l=mt(t,c,r);t=Object(u.a)(l,1)[0]}if(!gt(n,r)){var f=mt(n,c,r);n=Object(u.a)(f,1)[0]}var h=K(o,Be(c,0)),v=Oe(We(K(o,Be(t))),0,3),d=Oe(We(K(o,Be(n))),0,3);if(Math.abs(h.at(3))<1e-7)return[];var p=y.copy(Oe(We(h),0,3)),w=Ee(Ye(v,d),Ye(v,p))<0;Dn(e,Kt.new(p,3),i,a);var m=w?d:v;Dn(e,Jt.new(y.fromCols([m,p])),s,a)}function Pn(e,t,n,r,a,o,i,s){for(var u=t.xyboundsWorld,c=function(e){return J(u,e)},l=0;l<u.cols();l++){In(e,c(l),c((l+1)%u.cols()),n,r,o,i,s)}var f=t.options.z;if(f&&f>0){var h=y.copy(u);G(Y(h,2),f);for(var v=function(e){return J(h,e)},d=0;d<h.cols();d++){In(e,v(d),v((d+1)%h.cols()),n,r,o,i,s)}}}function Vn(e,t,n,r,a,o){for(var i=t.objects,s=t.drawFloorGrid,c=n.viewport,l=n.cam,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=[],v=[],d=ot.new({strokeStyle:Mt.new(.2,.2,.2,.6)}),p=Ve(0,0,e.getWidth(),e.getHeight()),w=K(p,o),m=a.map((function(e){return bt(e,w)})),b=l.pos,k=r[0],E=r[1],O=[k,E],j=[],C=[K(w,g.from([1,0,0,0])),K(w,g.from([0,1,0,0])),K(w,g.from([1,1,0,0]))],S=0;S<C.length;S++){var _=C[S];if(!(Math.abs(_.at(3))<1e-7)){var x=Oe(We(_),0,3);j.push(x)}}if(j.length>1){var M=j[0],L=j[1],z=mt(M,L,yt(g.from([0,0,0]),g.from([1,0,0]))),N=Object(u.a)(z,1),A=N[0],D=mt(M,L,yt(g.from([e.getWidth(),0,0]),g.from([1,0,0]))),T=Object(u.a)(D,1),I=T[0],P=Jt.new(y.from([A.at(0),A.at(1),0,I.at(0),I.at(1),0],3,2)),W=qt.new(P,ot.new({strokeStyle:Mt.BLACK}),P.center.at(2));h.push(W)}var R=ot.new({strokeStyle:Mt.AQUA.cp().a(.45)}),F=c.center,H=c.halfSize,q=[];if(s){var X=U(F,H),Q=X.at(0),$=X.at(1),Z=Bt(c.zoomLevel);Q=Z*Math.floor(Q/Z),$=Z*Math.floor($/Z);for(var ee=2*H.at(0),te=2*H.at(1),ne=Math.ceil(ee/Z)+1,re=Math.ceil(te/Z)+1,ae=be(Je,Z*ne),oe=be(Ke,Z*re),ie=0;ie<=ne;ie++){var se=g.from([Q+ie*Z,$,0]),ue=B(se,oe);q.push(Jt.new(y.fromCols([se,ue])))}for(var ce=0;ce<=re;ce++){var le=g.from([Q,$+ce*Z,0]),fe=B(le,ae);q.push(Jt.new(y.fromCols([le,fe])))}}for(var he=0;he<q.length;he++)Dn(h,q[he],R,a,w);if(i)for(var ve=ot.new({strokeStyle:Mt.GRAY.cp().a(.4)}),de=0;de<i.length;de++){var pe=i[de],we=pe.drawableWorld;Tn(pe,h,0,a,w,b,d);var me=V(pe.drawableWorld.points),ye=pe.options.sideGridStart,ge=pe.options.z;0!==ye&&(G(Y(me,2),ye),ge=Math.max(0,ge-ye));var ke=Nn({points:me,upDir:Xe,upHeight:ge,cellLength:pe.options.gridCellLength,cellHeight:pe.options.gridCellHeight,camPos:b,cullOptions:Mn(pe.options)});zn({queue:v,drawables:ke,styleData:pe.styleData,clipplanes:a,M:w});var Ee=pe.drawableWorld;Dn(v,Ee,pe.styleData,a,w),pe.options.showBoundVanishingLines&&Pn(h,pe,r[4],m,0,w,ot.new(),ve);var je=pe.options.z;if(je&&je>0){var Ce=Re(g.from([0,0,je])),Se=we.transform(Ce);Dn(v,Se,pe.styleData,a,w);var _e=we.points,xe=Se.points,Me=_e.cols(),Le=pe.styleData.copy();Le.set("lineWidth",2*Le.get("lineWidth",1));for(var ze=0;ze<Me;ze++){var Ne=Jt.new(y.fromCols([J(_e,ze),J(xe,ze)]));Dn(v,Ne,Le,a,w)}if(pe.options.displayCellLength)for(var Ae=Mn(pe.options),De=!1,Ie=0;Ie<Me;Ie++){var Pe=J(_e,Ie),Be=J(_e,(Ie+1)%Me),Ue=Te(Ye(Pe,Be),Xe);if(Ln(Pe,Ue,b,Ae)){if(!De){De=!1;continue}De=!1}else De=!0;for(var Ge=!1,Fe=0;Fe<O.length;Fe++)if(!gt(Pe,O[Fe])){Ge=!0;break}if(Ge){var He=V(Pe);He.set(je,2),Ge=!1;for(var qe=0;qe<O.length;qe++)if(!gt(He,O[qe])){Ge=!0;break}}if(!Ge){var Qe=pe.options.gridCellHeight,$e=V(Pe),Ze=pe.options.sideGridStart;$e.set(Ze,2);for(var et=Math.ceil((je-Ze)/Qe),tt=0;tt<=et;tt++){var rt=tt*Qe,at=B($e,be(Xe,rt));Dn(v,Xt.new(at,nt(rt,3)),pe.styleData,[r[4]],w)}}}}}h.sort((function(e,t){return t.z-e.z})),v.sort((function(e,t){return t.z-e.z}));for(var it=0!==f,st=it?Math.max(1,Math.round(f/2)):1,ut=0;ut<h.length;ut++){var ct=h[ut],lt=ct.styleData;it&&(lt=lt.copy()).set("lineWidth",lt.get("lineWidth",1)*st),ct.drawable.draw(e,lt)}for(var ft=0;ft<v.length;ft++){var ht=v[ft],vt=ht.styleData;it&&(vt=vt.copy()).set("lineWidth",vt.get("lineWidth",1)*st),ht.drawable.draw(e,vt)}}function Wn(e){var t=Object(r.useContext)(Un),n=e.objects,o=t.viewport,i=t.cam,c=wn(),l=Object(u.a)(c,2),f=l[0],h=l[1],v=Object(r.useState)(2),d=Object(u.a)(v,2),p=d[0],w=d[1],m=Object(r.useState)(o.zoomLevel),y=Object(u.a)(m,2),b=y[0],g=y[1],k=Object(r.useState)(!0),E=Object(u.a)(k,2),O=E[0],j=E[1],C=Bt(b),S=e.V,_=K(e.P,S),x=[],M=dt(_);x.push.apply(x,Object(s.a)(dt(_))),x.splice(5,1),Wt({cam:t.cam,setCam:t.setCam,camUp:Xe,canvas:f,speed:C});var L=t.setPerspective;Object(r.useEffect)((function(){null!==f&&L((function(e){return{fov:e.fov,aspect:f.width/f.height}}))}),[f,L]),Object(r.useEffect)((function(){if(null!==f){var e=At.new(at.new().canvas(f));e.initFrame(),Vn(e,{objects:n,drawFloorGrid:O},{viewport:o,cam:i},M,x,_),e.finishFrame()}}),[_,M,x,f,n,o,i,O]);return a.a.createElement("div",null,a.a.createElement("canvas",{tabIndex:"-1",ref:h,width:e.width,height:e.height,className:"perspectiveCanvas"},"Canvas not supported"),a.a.createElement("div",{className:"flex-container"},a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"title"},"3D Settings"),a.a.createElement(lt,{value:b,handleChange:function(e){return g(e)},valueName:"Movement speed",min:0,max:50,step:1,precision:0}),a.a.createElement(ct,{checked:O,labelText:"Draw floor grid",handleChange:function(e){return j(e)}})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"title"},"Options"),a.a.createElement(Bn,{canvas:f,buttonName:"Resize 3D canvas",position:"right",handleSizeChange:function(e,t){L((function(n){return{fov:n.fov,aspect:e/t}}))}})),a.a.createElement("div",{className:"flex-entry"},a.a.createElement("span",{className:"title"},"Download"),a.a.createElement(lt,{value:p,handleChange:function(e){return w(e)},valueName:"PNG size multiplier",min:1,max:5,step:1,precision:0}),a.a.createElement("button",{onClick:function(){if(null!==f){var e=Dt.new(f.width,f.height);e.initFrame(),Vn(e,{objects:n,drawFloorGrid:O},t,M,x,_),e.finishFrame();var r=new Date,a=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate();e.download(a+"_perspective_drawing")}}},"Download SVG"),a.a.createElement("button",{onClick:function(){if(null!==f){var e=document.createElement("canvas");e.width=p*f.width,e.height=p*f.height;var r=At.new(at.new().canvas(e));r.initFrame(),Vn(r,{objects:n,drawFloorGrid:O},t,M,x,_,p),r.finishFrame();var a=new Date,o=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();r.download(o+"_perspective_drawing")}}},"Download PNG"))))}function Bn(e){var t=e.canvas,n=e.buttonName,o=void 0===n?"Resize Canvas":n,i=e.handleSizeChange,s=e.position,c=void 0===s?"left":s,l=Object(r.useState)(!1),f=Object(u.a)(l,2),h=f[0],v=f[1],d=Object(r.useState)(0),p=Object(u.a)(d,2),w=p[0],m=p[1],y=Object(r.useState)(0),b=Object(u.a)(y,2),g=b[0],k=b[1],E=t?t.width:0,O=t?t.height:0;if(Object(r.useEffect)((function(){m((function(e){return E})),k((function(e){return O}))}),[E,O]),!t)return a.a.createElement("div",null,a.a.createElement("button",{disabled:!0},o));var j="resize-canvas-window";"left"===c?j+=" left-to":"right"===c&&(j+=" right-to");var C=a.a.createElement("div",{className:"popover"},a.a.createElement("div",{className:"fullscreen transparent",onClick:function(){return v((function(){return!1}))}}),a.a.createElement("div",{className:j},a.a.createElement("span",{className:"title"},"Resize canvas"),a.a.createElement("div",null,"Width: ",a.a.createElement(ft,{value:w,size:4,handleChange:function(e){return m(e)}})),a.a.createElement("div",null,"Height: ",a.a.createElement(ft,{value:g,size:4,handleChange:function(e){return k(e)}})),a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){t.width=Math.max(1,w),t.height=Math.max(1,g),i(w,g),v(!1)}},"Update size"),a.a.createElement("button",{onClick:function(){return v(!1)}},"Cancel"))));return a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){return v(!0)}},o),h?C:null)}var Un=a.a.createContext();function Gn(e){var t=Object(r.useState)([]),n=Object(u.a)(t,2),o=n[0],i=n[1],c=Object(r.useState)({pos:g.from([-.4,-1.5,1]),dir:g.from([.4,1.5,-1]),up:Xe}),l=Object(u.a)(c,2),f=l[0],h=l[1],v=Object(r.useState)({fov:Ge(90),aspect:1}),d=Object(u.a)(v,2),p=d[0],w=d[1],m=Object(r.useState)({center:g.from([0,0,0]),halfSize:g.from([Gt(0),Gt(0),0]),zoomLevel:0}),y=Object(u.a)(m,2),b=y[0],k=y[1],E=Pe(p.fov,p.aspect,.1,100),O=function(e,t,n){var r=U(e,t);ce(r,r);var a=Te(n,r);ce(a,a);var o=Te(r,a),i=$(P(e,4,4)),s=q(i,0,0,3,3);fe(Y(s,0),Z(a)),fe(Y(s,1),Z(o)),fe(Y(s,2),Z(r));var u=$(P(e,4,4));return fe(q(u,0,3,3,1),X(e)),K(i,u)}(f.pos,B(f.pos,f.dir),Xe),j=Object(r.useCallback)((function(e,t){i((function(n){var r=Object(s.a)(n);return r[t]=e,r}))}),[]),C=Object(r.useCallback)((function(e){i((function(t){return t.concat(e)}))}),[]),S=Object(r.useCallback)((function(e,t){i((function(e){var n=Object(s.a)(e);return n.splice(t,1),n}))}),[]);return a.a.createElement("div",null,a.a.createElement(Un.Provider,{value:{objects:o,setObjects:i,cam:f,setCam:h,perspective:p,setPerspective:w,V:O,P:E,viewport:b,setViewport:k}},a.a.createElement("div",{className:"main-container"},a.a.createElement("div",{className:"perspective-view"},a.a.createElement(Wn,{width:"720",height:"405",objects:o,V:O,P:E,viewport:b})),a.a.createElement("div",{className:"edit-view"},a.a.createElement(_n,{width:"400",height:"400",objects:o,objChangeHandler:j,onAddObject:C,handleDelete:S})))))}var Rn=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(Gn,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Rn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,n){e.exports=n(271)}},[[98,1,2]]]);
//# sourceMappingURL=main.a3eac73c.chunk.js.map